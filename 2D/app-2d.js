!function(){"use strict";var t="undefined"==typeof window?global:window;if("function"!=typeof t.require){var e={},r={},n={},a={}.hasOwnProperty,i="components/",o=function(t,e){var r=0;e&&(0===e.indexOf(i)&&(r=i.length),e.indexOf("/",r)>0&&(e=e.substring(r,e.indexOf("/",r))));var a=n[t+"/index.js"]||n[e+"/deps/"+t+"/index.js"];return a?i+a.substring(0,a.length-".js".length):t},s=/^\.\.?(\/|$)/,u=function(t,e){for(var r,n=[],a=(s.test(e)?t+"/"+e:e).split("/"),i=0,o=a.length;o>i;i++)r=a[i],".."===r?n.pop():"."!==r&&""!==r&&n.push(r);return n.join("/")},l=function(t){return t.split("/").slice(0,-1).join("/")},p=function(e){return function(r){var n=u(l(e),r);return t.require(n,e)}},c=function(t,e){var n={id:t,exports:{}};return r[t]=n,e(n.exports,p(t),n),n.exports},d=function(t,n){var i=u(t,".");if(null==n&&(n="/"),i=o(t,n),a.call(r,i))return r[i].exports;if(a.call(e,i))return c(i,e[i]);var s=u(i,"./index");if(a.call(r,s))return r[s].exports;if(a.call(e,s))return c(s,e[s]);throw new Error('Cannot find module "'+t+'" from "'+n+'"')};d.alias=function(t,e){n[e]=t},d.register=d.define=function(t,r){if("object"==typeof t)for(var n in t)a.call(t,n)&&(e[n]=t[n]);else e[t]=r},d.list=function(){var t=[];for(var r in e)a.call(e,r)&&t.push(r);return t},d.brunch=!0,d._cache=r,t.require=d}}(),require.define({"2D/BaseMapLayerManager":function(t,e,r){var n,a,i,o,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;o=e("./NNode"),a=e("./BaseMapSelectorUI"),i=e("./MapView"),s=e("./SessionController"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.streetMap=L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{}),this.satelliteMap=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",{subdomains:["otile1","otile2","otile3","otile4"]}),this.earthquakeDensityMap=L.tileLayer("http://{s}.tiles.mapbox.com/v3/bclc-apec.map-rslgvy56/{z}/{x}/{y}.png",{}),this.sessionController=s,this.baseLayer="satellite",this.previousBaseLayer=null,this.mapView=i,this.baseMapSelector=a,this.baseMapSelector.subscribe("update",function(t){return function(e){return t.baseLayer=e,t.updateBaseLayer(),t.updateSession()}}(this)),this.sessionController.subscribe("update",function(t){return function(e){return"baseLayer"in e?(t.baseLayer=e.baseLayer,t.updateBaseLayer()):void 0}}(this)),this.updateBaseLayer(),this.updateSession()}return u(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{baseLayer:this.baseLayer})},e.prototype.updateBaseLayer=function(){return this.baseMapSelector.tell("set",this.baseLayer),this.previousBaseLayer!==this.baseLayer?(null!=this.previousBaseLayer&&this.mapView.tell("remove-layer",this.getLayer(this.previousBaseLayer)),this.mapView.tell("add-layer",this.getLayer(this.baseLayer)),this.previousBaseLayer=this.baseLayer):void 0},e.prototype.getLayer=function(t){switch(t){case"street":return this.streetMap;case"satellite":return this.satelliteMap;case"density":return this.earthquakeDensityMap}},e}(o))}}),require.define({"2D/BaseMapSelectorUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){var t;e.__super__.constructor.apply(this,arguments),t=!1,this.baseMapSelector=$("#base-map-selector"),this.baseMapSelector.on("change",function(e){return function(){return t?void 0:e.post("update",e.baseMapSelector.val())}}(this)),this.listen("set",function(e){return function(r){return t=!0,e.baseMapSelector.val(r).selectmenu("refresh"),t=!1}}(this))}return i(e,t),e}(a))}}),require.define({"2D/BoundariesLayerManager":function(t,e,r){var n,a,i,o,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;o=e("./NNode"),a=e("./BoundariesToggleUI"),i=e("./MapView"),s=e("./SessionController"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.boundariesLayer=new L.KML("plates.kml",{async:!0}),this.boundariesVisible=!1,this.boundariesPreviouslyVisible=!1,this.sessionController=s,this.mapView=i,this.boundariesToggle=a,this.boundariesToggle.subscribe("update",function(t){return function(e){return t.boundariesVisible=e,t.updateBoundaries(),t.updateSession()}}(this)),this.sessionController.subscribe("update",function(t){return function(e){return"boundariesVisible"in e?(t.boundariesVisible=e.boundariesVisible,t.updateBoundaries()):void 0}}(this)),this.updateSession()}return u(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{boundariesVisible:this.boundariesVisible})},e.prototype.updateBoundaries=function(){return this.boundariesToggle.tell("set",this.boundariesVisible),this.boundariesVisible?(this.boundariesPreviouslyVisible||this.mapView.tell("add-layer",this.boundariesLayer),this.post("update",!0)):(this.boundariesPreviouslyVisible&&this.mapView.tell("remove-layer",this.boundariesLayer),this.post("update",!1)),this.boundariesPreviouslyVisible=this.boundariesVisible},e}(o))}}),require.define({"2D/BoundariesToggleUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){var t;e.__super__.constructor.apply(this,arguments),t=!1,this.plateToggle=$("#plate-toggle"),this.plateToggle.on("change",function(e){return function(){return t?void 0:e.post("update",e.plateToggle.parent().hasClass("ui-flipswitch-active"))}}(this)),this.listen("set",function(e){return function(r){return t=!0,r?e.plateToggle.parent().addClass("ui-flipswitch-active"):e.plateToggle.parent().removeClass("ui-flipswitch-active"),t=!1}}(this))}return i(e,t),e}(a))}}),require.define({"2D/CacheFilter":function(t,e,r){var n,a,i,o=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=e("./NNode"),a=e("./EarthquakeProvider"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.cachedData=[],this.inputNode=a,this.inputNode.subscribe("stream",function(t){return function(e){return t.post("flush",e)}}(this))}return o(e,t),e}(i))}}),require.define({"2D/ControlsManager":function(t,e,r){var n,a,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=e("./NNode"),a=e("./ControlsUI"),o=e("./SessionController"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.controlsUI=a,this.sessionController=o,this.controlsVisible=!0,this.controls=$("#controls"),this.showControls=$("#show-controls"),this.controlsUI.subscribe("update",function(t){return function(){return t.controlsVisible=!t.controlsVisible,t.updateControlVisibility(),t.updateSession()}}(this)),this.sessionController.subscribe("update",function(t){return function(e){return"controlsVisible"in e?(t.controlsVisible=e.controlsVisible,t.updateControlVisibility()):void 0}}(this)),this.updateSession(),this.updateControlVisibility()}return s(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{controlsVisible:this.controlsVisible})},e.prototype.updateControlVisibility=function(){return this.controlsVisible?(this.controls.finish().slideDown(300),this.showControls.finish().fadeOut(300)):(this.controls.finish().slideUp(300),this.showControls.finish().fadeIn(300))},e}(i))}}),require.define({"2D/ControlsUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.showButton=$("#show-controls"),this.hideButton=$("#hide-controls"),this.showButton.add(this.hideButton).click(function(t){return function(){return t.post("update")}}(this))}return i(e,t),e}(a))}}),require.define({"2D/DataFormatter":function(t,e,r){var n,a,i;i=new Rainbow,a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r.exports=n=function(){function t(){}return t.MAX_DEPTH=700,t.depthToColor=function(e){return i.setNumberRange(0,t.MAX_DEPTH),"#"+i.colourAt(e)},t.magnitudeToRadius=function(t){return.9*Math.pow(1.5,t-1)},t.formatMagnitude=function(t){return t.toFixed(1)},t.formatDate=function(t){var e;return e=new Date(t),a[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()},t}()}}),require.define({"2D/DateFilter":function(t,e,r){var n,a,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=e("./NNode"),i=e("./MagnitudeFilter"),a=e("./DateFilterController"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.controller=a,this.startDate=-(1/0),this.endDate=1/0,this.controller.subscribe("update",function(t){return function(e){var r;return e.startDate>t.startDate||e.endDate<t.endDate?t.post("flush",t.filterDates(t.cachedData,e.startDate,e.endDate)):(r=[],t.filterDates(t.cachedData,e.startDate,t.startDate,r),t.filterDates(t.cachedData,t.endDate,e.endDate,r),r.length>0&&t.post("stream",r)),t.startDate=e.startDate,t.endDate=e.endDate}}(this)),this.cachedData=[],this.inputNode=i,this.inputNode.subscribe("stream",function(t){return function(e){var r,n,a;for(r=0,n=e.length;n>r;r++)a=e[r],t.cachedData.push(a);return t.post("stream",t.filterDates(e,t.startDate,t.endDate))}}(this)),this.inputNode.subscribe("flush",function(t){return function(e){return t.cachedData=e,t.post("flush",t.filterDates(t.cachedData,t.startDate,t.endDate))}}(this))}return s(e,t),e.prototype.filterDates=function(t,e,r,n){var a,i,o,s;for(null==n&&(n=[]),a=0,i=t.length;i>a;a++)o=t[a],e<=(s=o.properties.time)&&r>s&&n.push(o);return n},e}(o))}}),require.define({"2D/DateFilterController":function(t,e,r){var n,a,i,o,s,u,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=e("./NNode"),s=e("./PlaybackController"),i=e("./DateRangeSliderUI"),n=e("./DataFormatter"),u=e("./SessionController"),r.exports=new(a=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.minDate=new Date(1900,0).valueOf(),this.maxDate=Date.now(),this.startDate=new Date(1958,0).valueOf(),this.endDate=this.maxDate,this.sliderDate=this.maxDate,this.sessionController=u,this.playbackController=s,this.playbackController.subscribe("update",function(t){return function(e){return t.sliderDate=e*(t.endDate-t.startDate)+t.startDate,t.limitDatesJustInCase(),t.postControllerChanges(),t.updatePlaybackSliderTextOnly(),t.updateSession()}}(this)),this.dateRangeSlider=i,this.dateRangeSlider.subscribe("update-start",function(t){return function(e){return t.startDate=new Date(e,0).valueOf(),t.limitDatesJustInCase(),t.postControllerChanges(),t.updateDateRange(),t.updatePlaybackSlider(),t.updateSession()}}(this)),this.dateRangeSlider.subscribe("update-end",function(t){return function(e){return t.endDate=new Date(e,11,31).valueOf(),t.sliderDate=1/0,t.limitDatesJustInCase(),t.postControllerChanges(),t.updateDateRange(),t.updatePlaybackSlider(),t.updateSession()}}(this)),this.listen("request-update",this.postControllerChanges),this.sessionController.subscribe("update",function(t){return function(e){var r;return r=!1,"startDate"in e&&(t.startDate=e.startDate,r=!0),"sliderDate"in e&&(t.sliderDate=e.sliderDate,r=!0),"endDate"in e&&(t.endDate=e.endDate,r=!0),"minDate"in e&&(t.minDate=e.minDate,r=!0),"maxDate"in e&&(t.maxDate=e.maxDate,r=!0),r?(t.limitDatesJustInCase(),t.postControllerChanges(),t.updateDateRange(),t.updatePlaybackSlider()):void 0}}(this)),this.updatePlaybackSlider(),this.updateDateRange(),this.updateSession()}return l(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{startDate:this.startDate,sliderDate:this.sliderDate,endDate:this.endDate,minDate:this.minDate,maxDate:this.maxDate})},e.prototype.limitDatesJustInCase=function(){return this.minYear=Math.min(this.minYear,this.maxYear),this.endDate=Math.min(this.endDate,this.maxDate),this.startDate=Math.max(this.startDate,this.minDate),this.sliderDate=Math.round(Math.min(Math.max(this.sliderDate,this.startDate),this.endDate))},e.prototype.postControllerChanges=function(){return this.post("update",{startDate:this.startDate,endDate:this.sliderDate})},e.prototype.updatePlaybackSliderTextOnly=function(){return this.playbackController.tell("set-text",""+n.formatDate(this.sliderDate))},e.prototype.updatePlaybackSlider=function(){var t,e,r;return this.playbackController.tell("set",(this.sliderDate-this.startDate)/(this.endDate-this.startDate)||0),e=this.endDate-this.startDate,r=864e5,t=e/r|0,this.playbackController.tell("set-step",1/t),this.updatePlaybackSliderTextOnly()},e.prototype.updateDateRange=function(){var t,e;return e=new Date(this.startDate).getFullYear(),t=new Date(this.endDate).getFullYear(),this.dateRangeSlider.tell("configure",{minYear:new Date(this.minDate).getFullYear(),maxYear:new Date(this.maxDate).getFullYear(),yearStep:1}),this.dateRangeSlider.tell("set-text",e+" and "+t),this.dateRangeSlider.tell("set",e,t)},e}(o))}}),require.define({"2D/DateRangeSliderUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){var t;e.__super__.constructor.apply(this,arguments),t=!1,this.dateSliderStart=$("#date-slider-start"),this.dateSliderEnd=$("#date-slider-end"),this.dateSliderReadout=$("#date-slider-readout"),this.listen("configure",function(t){return function(e){var r,n,a;return n=e.minYear,r=e.maxYear,a=e.yearStep,t.dateSliderStart.add(t.dateSliderEnd).attr("min",n).attr("max",r).attr("step",a)}}(this)),this.listen("set",function(e){return function(r,n){return t=!0,e.dateSliderStart.val(r),e.dateSliderEnd.val(n),e.dateSliderStart.add(e.dateSliderEnd).slider("refresh"),t=!1}}(this)),this.dateSliderStart.on("change",function(e){return function(){return t?void 0:e.post("update-start",parseInt(e.dateSliderStart.val()))}}(this)),this.dateSliderEnd.on("change",function(e){return function(){return t?void 0:e.post("update-end",parseInt(e.dateSliderEnd.val()))}}(this)),this.listen("set-text",function(t){return function(e){return t.dateSliderReadout.text(e)}}(this))}return i(e,t),e}(a))}}),require.define({"2D/EarthquakeLayerManager":function(t,e,r){var n,a,i,o,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=e("./NNode"),a=e("./DateFilter"),o=e("./MapView"),n=e("./DataFormatter"),r.exports=new(i=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.inputNode=a,this.mapView=o,this.earthquakesLayer=null,this.cachedData=[],this.inputNode.subscribe("stream",function(t){return function(e){var r,n,a;for(r=0,n=e.length;n>r;r++)a=e[r],t.cachedData.push(a);return t.addToLayer(e)}}(this)),this.inputNode.subscribe("flush",function(t){return function(e){return t.cachedData=e,t.flushLayer(e)}}(this)),this.flushLayer(),this.flushDeferTimer=null}return u(e,t),e.FLUSH_DEFER_TIME=300,e.prototype.addToLayer=function(t){return this.earthquakesLayer.addData(t)},e.prototype.flushLayer=function(t){return null!=this.earthquakesLayer&&this.mapView.tell("remove-layer",this.earthquakesLayer),this.earthquakesLayer=L.geoJson([],{pointToLayer:function(t,e){var r,a,i,o;return r=t.geometry.coordinates[2],a=t.properties.mag,o={clickable:!0,weight:1.5,opacity:.2,color:"#000",fillOpacity:.8,fillColor:n.depthToColor(r),radius:n.magnitudeToRadius(a)},i=L.circleMarker(e,o),i.bindPopup("Place: <b>"+t.properties.place+"</b></br>\nMagnitude: <b>"+n.formatMagnitude(a)+"</b></br>\nDate: <b>"+n.formatDate(t.properties.time)+"</b></br>\nDepth: <b>"+r+" km</b>"),i}}),this.mapView.tell("add-layer",this.earthquakesLayer),null!=t?(null!=this.flushDeferTimer&&clearTimeout(this.flushDeferTimer),this.flushDeferTimer=setTimeout(function(e){return function(){return e.addToLayer(t)}}(this),e.FLUSH_DEFER_TIME)):void 0},e}(s))}}),require.define({"2D/EarthquakeProvider":function(t,e,r){var n,a,i,o=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;a=e("./NNode"),i=e("./SessionController"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.sessionController=i,this.cachedDatasets=[],this.datasets=[],$(document).ready(function(t){return function(){return t.loadDatasets()}}(this)),this.sessionController.subscribe("update",function(t){return function(e){return"datasets"in e?(t.datasets=e.datasets,t.loadDatasets()):void 0}}(this)),this.updateSession()}return o(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{datasets:this.datasets})},e.prototype.loadDatasets=function(){var t,e,r,n,a;for(n=this.datasets,a=[],e=0,r=n.length;r>e;e++)t=n[e],this.cachedDatasets.push(t),a.push($.ajax(t).error(function(){}).done(function(t){return function(e){return t.post("stream",e.features)}}(this)));return a},e}(a))}}),require.define({"2D/HashController":function(t,e,r){var n,a,i,o=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;a=e("./NNode"),i=e("./SessionController"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.sessionController=i,this.delayedTimer=null,this.lastUpdate=null,this.lastHash=null,this.loadedHack=!1,this.sessionController.subscribe("append",function(t){return function(e){return t.loadedHack?(null!=t.delayedTimer&&(clearTimeout(t.delayedTimer),t.delayedTimer=null),null!=t.lastUpdate&&Date.now()-t.lastUpdate<1500?t.delayedTimer=setTimeout(function(){return t.updateLink(e)},300):t.updateLink(e)):void 0}}(this)),$(window).on("hashchange",function(t){return function(){return t.manageHashChange()}}(this)),$(window).on("load",function(t){return function(){return t.loadedHack=!0,t.manageHashChange()}}(this))}return o(e,t),e.prototype.manageHashChange=function(){var t,e;if(this.lastHash!==window.location.hash){if(this.isScaffoldHash(window.location.hash))this.post("scaffold-update",window.location.hash.slice(10)),this.sessionController.tell("append",{});else{try{this.sessionController.tell("replace-and-update",JSON.parse(window.decodeURIComponent(window.location.hash.slice(1))))}catch(e){t=e,this.loadDefaults()}this.sessionController.tell("append",{})}return this.lastHash=window.location.hash}},e.prototype.loadDefaults=function(){return console.log("defaults"),this.post("scaffold-update","regions/world.json")},e.prototype.updateLink=function(t){return window.location.hash=this.lastHash="#"+window.encodeURIComponent(JSON.stringify(t)),$("#share-link").val(""+window.location),this.lastUpdate=Date.now()},e.prototype.isScaffoldHash=function(t){return null!=t?t.startsWith("#scaffold:"):void 0},e}(a))}}),require.define({"2D/MagnitudeFilter":function(t,e,r){var n,a,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=e("./NNode"),n=e("./CacheFilter"),i=e("./MagnitudeFilterController"),r.exports=new(a=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.controller=i,this.startMagnitude=-(1/0),this.endMagnitude=1/0,this.controller.subscribe("update",function(t){return function(e){var r;return e.endMagnitude=1/0,e.startMagnitude>t.startMagnitude||e.endMagnitude<t.endMagnitude?t.post("flush",t.filterMagnitudes(t.cachedData,e.startMagnitude,e.endMagnitude)):(r=[],t.filterMagnitudes(t.cachedData,e.startMagnitude,t.startMagnitude,r),t.filterMagnitudes(t.cachedData,t.endMagnitude,e.endMagnitude,r),r.length>0&&t.post("stream",r)),t.startMagnitude=e.startMagnitude,t.endMagnitude=e.endMagnitude}}(this)),this.cachedData=[],this.inputNode=n,this.inputNode.subscribe("stream",function(t){return function(e){var r,n,a;for(r=0,n=e.length;n>r;r++)a=e[r],t.cachedData.push(a);return t.post("stream",t.filterMagnitudes(e,t.startMagnitude,t.endMagnitude))}}(this)),this.inputNode.subscribe("flush",function(t){return function(e){return t.cachedData=e,t.post("flush",t.filterMagnitudes(t.cachedData,t.startMagnitude,t.endMagnitude))}}(this))}return s(e,t),e.prototype.filterMagnitudes=function(t,e,r,n){var a,i,o,s;for(null==n&&(n=[]),a=0,i=t.length;i>a;a++)o=t[a],e<=(s=o.properties.mag)&&r>s&&n.push(o);return n},e}(o))}}),require.define({"2D/MagnitudeFilterController":function(t,e,r){var n,a,i,o,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;o=e("./NNode"),i=e("./MagnitudeSliderUI"),n=e("./DataFormatter"),s=e("./SessionController"),r.exports=new(a=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.minMagnitude=3,this.maxMagnitude=9,this.startMagnitude=5,this.sessionController=s,this.uiMagnitudeSlider=i,this.uiMagnitudeSlider.subscribe("update",function(t){return function(e){return t.startMagnitude=e,t.limitMagnitudeJustInCase(),t.postControllerChanges(),t.updateMagnitudeSlider(),t.updateSession()}}(this)),this.sessionController.subscribe("update",function(t){return function(e){var r;return r=!1,"startMagnitude"in e&&(t.startMagnitude=e.startMagnitude,r=!0),"minMagnitude"in e&&(t.minMagnitude=e.minMagnitude,r=!0),"maxMagnitude"in e&&(t.maxMagnitude=e.maxMagnitude,r=!0),r?(t.limitMagnitudeJustInCase(),t.postControllerChanges(),t.updateMagnitudeSlider()):void 0}}(this)),this.updateMagnitudeSlider(),this.updateSession(),this.listen("request-update",this.postControllerChanges)}return u(e,t),e.prototype.limitMagnitudeJustInCase=function(){return this.minMagnitude=Math.min(this.minMagnitude,this.maxMagnitude),this.startMagnitude=Math.min(Math.max(this.startMagnitude,this.minMagnitude),this.maxMagnitude)},e.prototype.updateSession=function(){return this.sessionController.tell("append",{startMagnitude:this.startMagnitude,minMagnitude:this.minMagnitude,maxMagnitude:this.maxMagnitude})},e.prototype.postControllerChanges=function(){return this.post("update",{startMagnitude:this.startMagnitude})},e.prototype.updateMagnitudeSlider=function(){return this.uiMagnitudeSlider.tell("configure",{minMagnitude:this.minMagnitude,maxMagnitude:this.maxMagnitude,magnitudeStep:.1}),this.uiMagnitudeSlider.tell("set-text",""+n.formatMagnitude(this.startMagnitude)),this.uiMagnitudeSlider.tell("set",this.startMagnitude)},e}(o))}}),require.define({"2D/MagnitudeSliderUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){var t;e.__super__.constructor.apply(this,arguments),t=!1,this.magnitudeSlider=$("#magnitude-slider"),this.magnitudeSliderReadout=$("#magnitude-readout"),this.listen("configure",function(t){return function(e){var r,n,a;return a=e.minMagnitude,n=e.maxMagnitude,r=e.magnitudeStep,t.magnitudeSlider.attr("min",a).attr("max",n).attr("step",r)}}(this)),this.magnitudeSlider.on("change",function(e){return function(){return t?void 0:e.post("update",parseFloat(e.magnitudeSlider.val()))}}(this)),this.listen("set",function(e){return t=!0,this.magnitudeSlider.val(e).slider("refresh"),t=!1}),this.listen("set-text",function(t){return this.magnitudeSliderReadout.text(t)})}return i(e,t),e}(a))}}),require.define({"2D/MapKeyController":function(t,e,r){var n,a,i,o,s,u,l,p=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;u=e("./NNode"),a=e("./DataFormatter"),s=e("./MapKeyToggleUI"),l=e("./SessionController"),o=e("./MapKeyPanelUI"),n=e("./BoundariesLayerManager"),r.exports=new(i=function(t){function e(){var t,r,i;e.__super__.constructor.apply(this,arguments),this.mapKey=$("#map-key"),this.boundariesKey=$("#map-key .boundaries-key"),this.boundariesLayerManager=n,this.mapKey.find(".magnitude-key").html(function(){var t,e;for(e=[],r=t=3;9>=t;r=++t)i=a.magnitudeToRadius(r),e.push('<div class="magnitude-item">\n  <div class="magnitude-example" style="width: '+2*i+"px; height: "+2*i+"px;margin-left: "+-i+"px; margin-top: "+-i+'px;"></div>\n  '+a.formatMagnitude(r)+"\n</div>");return e}().join("")),this.mapKey.find(".depth-key > .labels").html(function(){var e,r,n;for(n=[],t=e=0,r=a.MAX_DEPTH;r>=e;t=e+=100)n.push("<p>"+t+" km</p>");return n}().join("")),this.sessionController=l,this.sessionController.subscribe("update",function(t){return function(e){return"keyVisible"in e?(t.keyVisible=e.keyVisible,t.updateKeyVisibility()):void 0}}(this)),this.mapKeyToggle=s,this.mapKeyPanel=o,this.keyVisible=!1,this.mapKeyToggle.subscribe("update",function(t){return function(e){return t.keyVisible=e,t.updateKeyVisibility(),t.updateSession()}}(this)),this.mapKeyPanel.subscribe("update",function(t){return function(e){return t.keyVisible=!1,t.updateKeyVisibility(),t.updateSession()}}(this)),this.boundariesLayerManager.subscribe("update",function(t){return function(e){return e?t.boundariesKey.slideDown(300):t.boundariesKey.slideUp(300)}}(this)),this.updateSession()}return p(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{keyVisible:this.keyVisible})},e.prototype.updateKeyVisibility=function(){return this.mapKeyToggle.tell("set",this.keyVisible),this.keyVisible?this.mapKey.finish().fadeIn(300):this.mapKey.finish().fadeOut(300)},e}(u))}}),require.define({"2D/MapKeyPanelUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.mapKeyClose=$("#map-key-close"),this.mapKeyClose.on("click",function(t){return function(){return t.post("update")}}(this))}return i(e,t),e}(a))}}),require.define({"2D/MapKeyToggleUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){var t;e.__super__.constructor.apply(this,arguments),t=!1,this.mapKey=$("#map-key-toggle"),this.mapKey.on("change",function(e){return function(){return t?void 0:e.post("update",e.mapKey.parent().hasClass("ui-flipswitch-active"))}}(this)),this.listen("set",function(e){return function(r){return t=!0,r?e.mapKey.parent().addClass("ui-flipswitch-active"):e.mapKey.parent().removeClass("ui-flipswitch-active"),t=!1}}(this))}return i(e,t),e}(a))}}),require.define({"2D/MapPerspectiveManager":function(t,e,r){var n,a,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=e("./NNode"),a=e("./MapView"),o=e("./SessionController"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.sessionController=o,this.minLatitude=-40,this.minLongitude=-50,this.maxLatitude=40,this.maxLongitude=50,this.restrictedView=!1,this.previouslyRestrictedView=!1,this.mapView=a,this.mapView.subscribe("loaded",function(t){return function(){return t.updateMapView()}}(this)),this.mapView.subscribe("bounds-update",function(t){return function(e){var r,n;return n=e.getSouthWest(),r=e.getNorthEast(),t.minLatitude=n.lat,t.maxLatitude=r.lat,t.minLongitude=n.lng,t.maxLongitude=r.lng,t.updateSession()}}(this)),this.sessionController.subscribe("update",function(t){return function(e){var r;return r=!1,"minLatitude"in e&&(t.minLatitude=e.minLatitude,r=!0),"maxLatitude"in e&&(t.maxLatitude=e.maxLatitude,r=!0),"minLongitude"in e&&(t.minLongitude=e.minLongitude,r=!0),"maxLongitude"in e&&(t.maxLongitude=e.maxLongitude,r=!0),"restrictedView"in e&&(t.restrictedView=e.restrictedView,r=!0),r?t.updateMapView():void 0}}(this)),this.updateSession()}return s(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{minLatitude:this.minLatitude,minLongitude:this.minLongitude,maxLatitude:this.maxLatitude,maxLongitude:this.maxLongitude,restrictedView:this.restrictedView})},e.prototype.updateMapView=function(){var t;return this.previouslyRestrictedView&&this.mapView.tell("unfreeze"),t=L.latLngBounds(L.latLng(this.minLatitude,this.minLongitude),L.latLng(this.maxLatitude,this.maxLongitude)),this.mapView.tell("set-bounds",t),this.restrictedView&&this.mapView.tell("freeze",t),this.previouslyRestrictedView=this.restrictedView},e}(i))}}),require.define({"2D/MapView":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.leafletMap=L.map("map"),this.frozen=null,$(window).on("load",function(t){return function(){return t.leafletMap.invalidateSize(),t.post("loaded"),t.leafletMap.on("moveend",function(){return t.frozen?void 0:t.post("bounds-update",t.leafletMap.getBounds())})}}(this)),this.listen("add-layer",function(t){return function(e){return t.leafletMap.addLayer(e)}}(this)),this.listen("remove-layer",function(t){return function(e){return t.leafletMap.removeLayer(e)}}(this)),this.listen("freeze",function(t){return function(e){return t.frozen=!0,t.leafletMap.setMaxBounds(e),t.leafletMap.options.minZoom=t.leafletMap.options.maxZoom=t.leafletMap.getBoundsZoom(e)}}(this)),this.listen("unfreeze",function(t){return function(){return t.frozen=!1,t.leafletMap.setMaxBounds(null),t.leafletMap.options.minZoom=0,t.leafletMap.options.maxZoom=18}}(this)),this.listen("set-bounds",function(t){return function(e){return t.leafletMap.fitBounds(e)}}(this))}return i(e,t),e}(a))}}),require.define({"2D/NNode":function(t,e,r){var n,a=[].slice;r.exports=n=function(){function t(){this.listenerMap={},this.subscriberListenerMap={}}return t.prototype.post=function(){var t,e;return t=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],this._activateListeners(this.subscriberListenerMap,t,e)},t.prototype.subscribe=function(t,e){this._addToListenerMap(this.subscriberListenerMap,t,e)},t.prototype.tell=function(){var t,e;t=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],this._activateListeners(this.listenerMap,t,e)},t.prototype.listen=function(t,e){this._addToListenerMap(this.listenerMap,t,e)},t.prototype._addToListenerMap=function(t,e,r){null==t[e]&&(t[e]=[]),this._addToSet(t[e],r)},t.prototype._activateListeners=function(t,e,r){var n,a,i,o;if(null!=t[e])for(o=t[e],
n=0,a=o.length;a>n;n++)i=o[n],i.apply(this,r)},t.prototype._addToSet=function(t,e){-1===t.indexOf(e)&&t.push(e)},t}()}}),require.define({"2D/PlaybackButtonsUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;n=e("./NNode"),r.exports=new(a=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.slowDown=$("#slowdown"),this.playPause=$("#playpause"),this.speedUp=$("#speedup"),this.slowDown.click(function(t){return function(){return t.post("update","slowdown")}}(this)),this.playPause.click(function(t){return function(){return t.post("update","playpause")}}(this)),this.speedUp.click(function(t){return function(){return t.post("update","speedup")}}(this)),this.listen("set-play-or-pause",function(t){switch(t){case"play":return this.becomePlayButton();case"pause":return this.becomePauseButton()}})}return i(e,t),e.prototype.becomePlayButton=function(){return this.playPause.removeClass("ui-icon-fa-pause"),this.playPause.addClass("ui-icon-fa-play")},e.prototype.becomePauseButton=function(){return this.playPause.addClass("ui-icon-fa-pause"),this.playPause.removeClass("ui-icon-fa-play")},e}(n))}}),require.define({"2D/PlaybackController":function(t,e,r){var n,a,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;a=e("./PlaybackButtonsUI"),o=e("./PlaybackSliderUI"),n=e("./NNode"),r.exports=new(i=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.timeline=new TimelineLite({onUpdate:function(t){return function(){var e;return e=t.timeline.progress(),t.post("update",e),t.playbackSlider.tell("set",e),1===e?t.pauseOnly():void 0}}(this),paused:!0}),this.duration=16,this._updateTimelineScale(),this.timeline.addPause(1),this.playbackButtons=a,this.playbackButtons.subscribe("update",function(t){return function(e){switch(e){case"slowdown":return t.slowDown();case"playpause":return t.playPause();case"speedup":return t.speedUp()}}}(this)),this.playbackSlider=o,this.playbackSlider.subscribe("update",function(t){return function(e){return t.pauseOnly(),t.timeline.progress(e)}}(this)),this.listen("set",function(t){return function(e){return t.timeline.progress(e)}}(this)),this.listen("set-text",function(t){return function(e){return t.playbackSlider.tell("set-text",e)}}(this)),this.listen("set-step",function(t){return function(e){return t.playbackSlider.tell("set-step",e)}}(this))}return s(e,t),e.prototype.slowDown=function(){return this.duration<128&&(this.duration*=2),this._updateTimelineScale()},e.prototype.speedUp=function(){return this.duration>2&&(this.duration/=2),this._updateTimelineScale()},e.prototype.pauseOnly=function(){return this.timeline.pause(),this.playbackButtons.tell("set-play-or-pause","play")},e.prototype.playPause=function(){return this.timeline.isActive()?this.pauseOnly():(1===this.timeline.progress()?this.timeline.restart():this.timeline.play(),this.playbackButtons.tell("set-play-or-pause","pause"))},e.prototype._updateTimelineScale=function(){return this.timeline.timeScale(1/this.duration)},e}(n))}}),require.define({"2D/PlaybackSliderUI":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;n=e("./NNode"),r.exports=new(a=function(t){function e(){var t;e.__super__.constructor.apply(this,arguments),t=!1,this.slider=$("#slider"),this.sliderHandle=$("#slider-wrapper .ui-slider-handle"),this.slider.on("change",function(e){return function(){return t?void 0:e.post("update",parseFloat(e.slider.val()))}}(this)),this.listen("set",function(e){return function(r){return t=!0,e.slider.val(r).slider("refresh"),t=!1}}(this)),this.listen("set-text",function(t){return function(e){return t.sliderHandle.text(e),t.sliderHandle.attr("title",e)}}(this)),this.listen("set-step",function(t){return function(e){return t.slider.attr("step",e)}}(this))}return i(e,t),e}(n))}}),require.define({"2D/ScaffoldController":function(t,e,r){var n,a,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;a=e("./NNode"),o=e("./SessionController"),n=e("./HashController"),r.exports=new(i=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.sessionController=o,this.hashController=n,this.scaffold="",this.hashController.subscribe("scaffold-update",function(t){return function(e){return t.scaffold=e,t.updateScaffold(!0),t.updateSession()}}(this)),this.sessionController.subscribe("update",function(t){return function(e){return"scaffold"in e?(t.scaffold=e.scaffold,t.updateScaffold(!1)):void 0}}(this)),this.updateScaffold(),this.updateSession()}return s(e,t),e.prototype.updateSession=function(){return this.sessionController.tell("append",{scaffold:this.scaffold})},e.prototype.updateScaffold=function(t){return this.scaffold.length>0?$.ajax(this.scaffold).done(function(e){return function(r){return e.post("update",r),t?e.sessionController.tell("replace-and-update",r):void 0}}(this)):void 0},e}(a))}}),require.define({"2D/ScaffoldLayerManager":function(t,e,r){var n,a,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;a=e("./NNode"),i=e("./ScaffoldController"),n=e("./MapView"),r.exports=new(o=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.mapView=n,this.scaffoldLayer=null,this.scaffoldController=i,this.scaffoldController.subscribe("update",function(t){return function(e){return t.buildLayer(e)}}(this))}return s(e,t),e.prototype.buildLayer=function(t){return null!=this.scaffoldLayer&&this.mapView.tell("remove-layer",this.scaffoldLayer),this.scaffoldLayer=L.geoJson(t,{onEachFeature:function(t,e){return e.bindPopup(""+t.properties.label,{closeButton:!1,offset:new L.Point(0,0)}),e.on("click",function(e){return window.location.hash="scaffold:"+t.properties.scaffold,e.preventDefault()}),e.on("mouseover",function(){var t;return t=e.getBounds(),e.openPopup(new L.LatLng(t.getNorth(),t.getCenter().lng))}),e.on("mouseout",function(){return e.closePopup()})}}),this.mapView.tell("add-layer",this.scaffoldLayer)},e}(a))}}),require.define({"2D/SessionController":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;n=e("./NNode"),r.exports=new(a=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.session={},this.listen("append",function(t){return function(e){var r,n;for(r in e)n=e[r],t.session[r]=n;return t.post("append",t.session)}}(this)),this.listen("replace-and-update",function(t){return function(e){var r,n;n={};for(r in t.session)null!=e[r]&&typeof t.session[r]==typeof e[r]&&(t.isEqual(t.session[r],e[r])||(n[r]=t.session[r]=e[r]));return t.post("update",n)}}(this))}return i(e,t),e.prototype.isEqual=function(t,e){var r,n,a;if(t instanceof Array){if(t.length!==e.length)return!1;for(r=n=0,a=t.length;a>=0?a>n:n>a;r=a>=0?++n:--n)if(!this.isEqual(t[r],e[r]))return!1;return!0}return t===e},e}(n))}}),require.define({"2D/Utils":function(t,e,r){}}),require.define({"2D/app":function(t,e,r){var n,a,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;a=e("./NNode"),r.exports=new(n=function(t){function r(){r.__super__.constructor.apply(this,arguments),this.superHackySliderKeyboardHack(),e("./EarthquakeLayerManager"),e("./BoundariesLayerManager"),e("./BaseMapLayerManager"),e("./ScaffoldLayerManager"),e("./ControlsManager"),e("./MapKeyController"),e("./MapPerspectiveManager"),e("./HashController")}return i(r,t),r.prototype.superHackySliderKeyboardHack=function(){return $("#slider-wrapper .ui-slider-handle").keydown(function(t){var e,r;switch(e=$(this).parents(".ui-slider").find("input"),t.keyCode){case $.mobile.keyCode.HOME:r=parseFloat(e.attr("min"));break;case $.mobile.keyCode.END:r=parseFloat(e.attr("max"));break;case $.mobile.keyCode.PAGE_UP:case $.mobile.keyCode.UP:case $.mobile.keyCode.LEFT:r=parseFloat(e.val())-parseFloat(e.attr("step"));break;case $.mobile.keyCode.PAGE_DOWN:case $.mobile.keyCode.DOWN:case $.mobile.keyCode.RIGHT:r=parseFloat(e.val())+parseFloat(e.attr("step"));break;default:return}return e.val(r),$(e).slider("refresh")})},r}(a))}}),L.KML=L.FeatureGroup.extend({options:{async:!0},initialize:function(t,e){L.Util.setOptions(this,e),this._kml=t,this._layers={},t&&this.addKML(t,e,this.options.async)},loadXML:function(t,e,r,n){void 0==n&&(n=this.options.async),void 0==r&&(r=this.options);var a=new window.XMLHttpRequest;a.open("GET",t,n);try{a.overrideMimeType("text/xml")}catch(i){}a.onreadystatechange=function(){4==a.readyState&&200==a.status&&e(a.responseXML,r)},a.send(null)},addKML:function(t,e,r){var n=this,a=function(t,e){n._addKML(t,e)};this.loadXML(t,a,e,r)},_addKML:function(t,e){var r=L.KML.parseKML(t);if(r&&r.length){for(var n=0;n<r.length;n++)this.fire("addlayer",{layer:r[n]}),this.addLayer(r[n]);this.latLngs=L.KML.getLatLngs(t),this.fire("loaded")}},latLngs:[]}),L.Util.extend(L.KML,{parseKML:function(t){var e=this.parseStyle(t);this.parseStyleMap(t,e);for(var r,n=t.getElementsByTagName("Folder"),a=[],i=0;i<n.length;i++)this._check_folder(n[i])&&(r=this.parseFolder(n[i],e),r&&a.push(r));n=t.getElementsByTagName("Placemark");for(var o=0;o<n.length;o++)this._check_folder(n[o])&&(r=this.parsePlacemark(n[o],t,e),r&&a.push(r));return a},_check_folder:function(t,e){for(t=t.parentElement;t&&"Folder"!==t.tagName;)t=t.parentElement;return!t||t===e},parseStyle:function(t){function e(t){for(var r={},n=0;n<t.childNodes.length;n++){var i=t.childNodes[n],o=i.tagName;if(a[o])if("hotSpot"===o)for(var s=0;s<i.attributes.length;s++)r[i.attributes[s].name]=i.attributes[s].nodeValue;else{var u=i.childNodes[0].nodeValue;"color"===o?(r.opacity=parseInt(u.substring(0,2),16)/255,r.color="#"+u.substring(6,8)+u.substring(4,6)+u.substring(2,4)):"width"===o?r.weight=u:"Icon"===o?(p=e(i),p.href&&(r.href=p.href)):"href"===o&&(r.href=u)}}return r}for(var r={},n=t.getElementsByTagName("Style"),a={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},i=0;i<n.length;i++){var o,s=n[i],u={},l={},p={};o=s.getElementsByTagName("LineStyle"),o&&o[0]&&(u=e(o[0])),o=s.getElementsByTagName("PolyStyle"),o&&o[0]&&(l=e(o[0])),l.color&&(u.fillColor=l.color),l.opacity&&(u.fillOpacity=l.opacity),o=s.getElementsByTagName("IconStyle"),o&&o[0]&&(p=e(o[0])),p.href&&(u.icon=new L.KMLIcon({iconUrl:p.href,shadowUrl:null,iconAnchorRef:{x:p.x,y:p.y},iconAnchorType:{x:p.xunits,y:p.yunits}})),r["#"+s.getAttribute("id")]=u}return r},parseStyleMap:function(t,e){for(var r=t.getElementsByTagName("StyleMap"),n=0;n<r.length;n++){var a,i,o,s=r[n];a=s.getElementsByTagName("key"),a&&a[0]&&(i=a[0].textContent),a=s.getElementsByTagName("styleUrl"),a&&a[0]&&(o=a[0].textContent),"normal"==i&&(e["#"+s.getAttribute("id")]=e[o])}},parseFolder:function(t,e){var r,n,a=[];r=t.getElementsByTagName("Folder");for(var i=0;i<r.length;i++)this._check_folder(r[i],t)&&(n=this.parseFolder(r[i],e),n&&a.push(n));r=t.getElementsByTagName("Placemark");for(var o=0;o<r.length;o++)this._check_folder(r[o],t)&&(n=this.parsePlacemark(r[o],t,e),n&&a.push(n));if(a.length)return 1===a.length?a[0]:new L.FeatureGroup(a)},parsePlacemark:function(t,e,r){var n,a,i,o={};for(i=t.getElementsByTagName("styleUrl"),n=0;n<i.length;n++){var s=i[n].childNodes[0].nodeValue;for(var u in r[s])o[u]=r[s][u]}var l=[],p=["LineString","Polygon","Point"];for(a in p){var c=p[a];for(i=t.getElementsByTagName(c),n=0;n<i.length;n++){var d=this["parse"+c](i[n],e,o);d&&l.push(d)}}if(l.length){var h=l[0];l.length>1&&(h=new L.FeatureGroup(l));var f,m="";for(i=t.getElementsByTagName("name"),i.length&&i[0].childNodes.length&&(f=i[0].childNodes[0].nodeValue),i=t.getElementsByTagName("description"),n=0;n<i.length;n++)for(a=0;a<i[n].childNodes.length;a++)m+=i[n].childNodes[a].nodeValue;return f&&h.bindPopup("<h2>"+f+"</h2>"+m),h}},parseCoords:function(t){var e=t.getElementsByTagName("coordinates");return this._read_coords(e[0])},parseLineString:function(t,e,r){var n=this.parseCoords(t);if(n.length)return new L.Polyline(n,r)},parsePoint:function(t,e,r){var n=t.getElementsByTagName("coordinates");if(n.length){var a=n[0].childNodes[0].nodeValue.split(",");return new L.KMLMarker(new L.LatLng(a[1],a[0]),r)}},parsePolygon:function(t,e,r){var n,a,i,o=[],s=[];for(n=t.getElementsByTagName("outerBoundaryIs"),a=0;a<n.length;a++)i=this.parseCoords(n[a]),i&&o.push(i);for(n=t.getElementsByTagName("innerBoundaryIs"),a=0;a<n.length;a++)i=this.parseCoords(n[a]),i&&s.push(i);return o.length?(r.fillColor&&(r.fill=!0),1===o.length?new L.Polygon(o.concat(s),r):new L.MultiPolygon(o,r)):void 0},getLatLngs:function(t){for(var e=t.getElementsByTagName("coordinates"),r=[],n=0;n<e.length;n++)r=r.concat(this._read_coords(e[n]));return r},_read_coords:function(t){var e,r="",n=[];for(e=0;e<t.childNodes.length;e++)r+=t.childNodes[e].nodeValue;for(r=r.split(/[\s\n]+/),e=0;e<r.length;e++){var a=r[e].split(",");a.length<2||n.push(new L.LatLng(a[1],a[0]))}return n}}),L.KMLIcon=L.Icon.extend({createIcon:function(){var t=this._createIcon("icon");return t.onload=function(){var e=t;this.style.width=e.width+"px",this.style.height=e.height+"px",("UNITS_FRACTION"===this.anchorType.x||"fraction"===this.anchorType.x)&&(t.style.marginLeft=-this.anchor.x*e.width+"px"),("UNITS_FRACTION"===this.anchorType.y||"fraction"===this.anchorType.x)&&(t.style.marginTop=-(1-this.anchor.y)*e.height+"px"),this.style.display=""},t},_setIconStyles:function(t,e){L.Icon.prototype._setIconStyles.apply(this,[t,e]),t.anchor=this.options.iconAnchorRef,t.anchorType=this.options.iconAnchorType}}),L.KMLMarker=L.Marker.extend({options:{icon:new L.KMLIcon.Default}}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],r=0,n=t.length;n>r;r++)e.push(this.cloneLatLng(t[r]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane),this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):(console.log("hello"),this)},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),r=this._container;return this._container&&(r.style.visibility="inherit",L.DomUtil.setPosition(r,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this}}),require.define({"2D/extensions/custom-polyline":function(t,e,r){var n,a=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype._onMouseUp=function(t){var r;return e.__super__._onMouseUp.apply(this,arguments),2===(null!=(r=this._markers)?r.length:void 0)?this._finishShape():void 0},e}(L.Draw.Polyline),r.exports=n}}),require.define({"2D/thisfolderisacomment/app":function(t,e,r){var n,a,i;a=e("2D/map"),i=e("2D/map-controller"),n=function(){function t(){this.util=e("common/util"),this.map=new a,this.controller=new i(this.map),$("#index").on("pageshow",function(t){return function(e,r){return $.mobile.loading("show"),t.map.leafletMap.invalidateSize(!0),t.map.layers.baseLayer2.addTo(t.map.leafletMap),null!=t.map.parameters.center&&null!=t.map.parameters.zoom?t.map.leafletMap.setView(t.map.parameters.center,t.map.parameters.zoom):t.map.leafletMap.fitBounds(L.latLngBounds(t.map.parameters.nw,t.map.parameters.se)),t.controller.initController(),t.controller.timeLine.timeScale(t.controller.speed),t.controller.timeLine.pause(),$.mobile.loading("hide"),setTimeout(function(){return t.map.leafletMap.invalidateSize()},1),t.init()}}(this))}return t.prototype.init=function(){var t,e,r,n,a,i,o;return $("#play").click(function(t){return function(){return t.controller.timeLine.resume()}}(this)),$("#pause").click(function(t){return function(){return t.controller.timeLine.pause()}}(this)),$("#speedup").click(function(t){return function(){return t.controller.speed*=1.5,t.controller.timeLine.timeScale(t.controller.speed)}}(this)),$("#speeddown").click(function(t){return function(){return t.controller.speed>=.5?(t.controller.speed/=2,t.controller.timeLine.timeScale(t.controller.speed)):void 0}}(this)),$("#changeparams").click(function(t){return function(){return t.controller.timeLine.pause()}}(this)),$("#editparamscancel").click(function(t){return function(){return t.controller.timeLine.resume()}}(this)),$("#editparamsenter").click(function(t){return function(){return t.controller.timeLine.pause()}}(this)),this.map.parameters.timeline&&$("#options-button").attr("href","#options-details"),$("#daterange").dateRangeSlider({arrows:!1,bounds:{min:new Date(1900,0,1),max:Date.now()},defaultValues:{min:new Date(this.map.parameters.startdate),max:new Date(this.map.parameters.enddate)},scales:[{next:function(t){var e;return e=new Date(t),new Date(e.setYear(t.getFullYear()+20))},label:function(t){return t.getFullYear()}}]}),$("#magnitude-slider").val(this.map.parameters.desiredMag||this.map.parameters.mag).slider("refresh"),$.datepicker.setDefaults({minDate:new Date(1900,0,1),maxDate:0,changeMonth:!0,changeYear:!0}),n=function(t){var e,r;return r=$("#daterange").dateRangeSlider("values"),e=new Date(t),$("#daterange").dateRangeSlider("values",e,r.max)},r=function(t){var e,r;return r=$("#daterange").dateRangeSlider("values"),e=new Date(t),$("#daterange").dateRangeSlider("values",r.min,e)},$(".ui-rangeSlider-leftLabel").click(function(t){return $(".ui-rangeSlider-leftLabel").datepicker("dialog",$("#daterange").dateRangeSlider("values").min,n,{},t)}),$(".ui-rangeSlider-rightLabel").click(function(t){return $(".ui-rangeSlider-rightLabel").datepicker("dialog",$("#daterange").dateRangeSlider("values").max,r,{},t)}),o=function(t){return function(){var e,r,n;return r=$("#daterange").dateRangeSlider("values"),e=t.util.queryString(t.map,{startdate:t.util.usgsDate(r.min),enddate:t.util.usgsDate(r.max),mag:$("#magnitude-slider").val()}),n=window.location.origin+window.location.pathname+e,$("#share-link").attr("href",n),$("#share-link").text(n)}}(this),e=null,$("#getQuakeCount").click(function(t){return function(){var r,n,a;return $(t).addClass("ui-disabled"),$("#quake-count").html("Earthquakes: ???"),n=$("#daterange").dateRangeSlider("values"),a=t.util.usgsDate(n.min),r=t.util.usgsDate(n.max),e=document.createElement("script"),e.src="http://earthquake.usgs.gov/fdsnws/event/1/count?starttime="+a+"&endtime="+r+"&eventtype=earthquake&format=geojson"+t.geojsonParams(),e.id="quake-count-script",document.body.appendChild(e),o()}}(this)),window.updateQuakeCount=function(t){return $("#quake-count").html("Earthquakes: "+t.count),e=document.getElementById("quake-count-script"),document.body.removeChild(e),$("#getQuakeCount").removeClass("ui-disabled")},$("#loadSelectedData").click(function(t){return function(){var e;return e=$("#daterange").dateRangeSlider("values"),t.map.parameters.startdate=t.util.usgsDate(e.min),t.map.parameters.enddate=t.util.usgsDate(e.max),t.map.parameters.desiredMag=$("#magnitude-slider").val(),t.controller.reloadData(),history.pushState({mapParams:t.map.parameters},"Seismic Eruptions",t.util.queryString(t.map)),o()}}(this)),$("#share-wrapper").hide(),$("#shareSelectedData").click(function(){return o(),$("#share-wrapper").show()}),t=!1,$("#drawingTool").click(function(e){return function(){var r,n,a;if(!t){for(e.controller.timeLine.pause(),$.mobile.loading("show"),$("#crosssection").fadeIn(),r=n=0,a=e.map.values.size;a>=0?a>n:n>a;r=a>=0?++n:--n)e.map.leafletMap.hasLayer(e.map.earthquakes.circles[r])||(e.map.earthquakes.circles[r].setStyle({fillOpacity:.5,fillColor:"#"+e.controller.rainbow.colourAt(e.map.earthquakes.depth[r])}),e.map.earthquakes.circles[r].addTo(e.map.leafletMap));return $.mobile.loading("hide"),t=!0}}}(this)),$("#drawingToolDone").click(function(e){return function(){return t?($.mobile.loading("show"),$("#crosssection").fadeOut(),$.mobile.loading("hide"),t=!1,e.map.leafletMap.setZoom(2)):void 0}}(this)),$("#mapselector").change(function(t){return function(){switch(t.map.leafletMap.hasLayer(t.map.layers.baseLayer1)&&t.map.leafletMap.removeLayer(t.map.layers.baseLayer1),t.map.leafletMap.hasLayer(t.map.layers.baseLayer2)&&t.map.leafletMap.removeLayer(t.map.layers.baseLayer2),t.map.leafletMap.hasLayer(t.map.layers.baseLayer3)&&t.map.leafletMap.removeLayer(t.map.layers.baseLayer3),$("#mapselector").val()){case"1":if(t.map.layers.baseLayer1.addTo(t.map.leafletMap),t.map.leafletMap.hasLayer(t.map.layers.baseLayer2)&&t.map.leafletMap.removeLayer(t.map.layers.baseLayer2),t.map.leafletMap.hasLayer(t.map.layers.baseLayer3))return t.map.leafletMap.removeLayer(t.map.layers.baseLayer3);break;case"2":if(t.map.layers.baseLayer2.addTo(t.map.leafletMap),t.map.leafletMap.hasLayer(t.map.layers.baseLayer3)&&t.map.leafletMap.removeLayer(t.map.layers.baseLayer3),t.map.leafletMap.hasLayer(t.map.layers.baseLayer1))return t.map.leafletMap.removeLayer(t.map.layers.baseLayer1);break;case"3":if(t.map.layers.baseLayer3.addTo(t.map.leafletMap),t.map.leafletMap.hasLayer(t.map.layers.baseLayer2)&&t.map.leafletMap.removeLayer(t.map.layers.baseLayer2),t.map.leafletMap.hasLayer(t.map.layers.baseLayer1))return t.map.leafletMap.removeLayer(t.map.layers.baseLayer1)}}}(this)),$("#date-1-y").change(function(){return loadCount(1)}),$("#date-1-m").change(function(){return loadCount(1)}),$("#date-2-y").change(function(){return loadCount(1)}),$("#date-2-m").change(function(){return loadCount(1)}),i=function(){var t,e,r;for($("#overlay").fadeIn(),$("#startDrawingToolButton").fadeOut(),$("#Drawingtools").fadeIn(),$("#slider").slider({disabled:!0}),document.getElementById("play").disabled=!0,document.getElementById("pause").disabled=!0,document.getElementById("speedup").disabled=!0,document.getElementById("speeddown").disabled=!0,tl.pause(),t=e=0,r=this.map.values.size;r>e;t=e+=1)this.map.leafletMap.hasLayer(this.map.earthquakes.circles[t])||(this.map.earthquakes.circles[t].setStyle({fillOpacity:.5,fillColor:"#"+this.controller.rainbow.colourAt(this.map.earthquakes.depth[t])}),this.map.earthquakes.circles[t].addTo(this.map.leafletMap));return $("#overlay").fadeOut()},a=function(){return $("#overlay").fadeIn(),$("#startDrawingToolButton").fadeIn(),$("#Drawingtools").fadeOut(),$("#slider").slider({disabled:!1}),document.getElementById("play").disabled=!1,document.getElementById("pause").disabled=!1,document.getElementById("speedup").disabled=!1,document.getElementById("speeddown").disabled=!1,$("#overlay").fadeOut()}},t.prototype.geojsonParams=function(){var t,e,r,n,a,i,o;return t=this.map.leafletMap.getBounds(),a=t.getNorthWest(),i=t.getSouthEast(),n=$("#magnitude-slider").val(),e=a.lat-i.lat,r=i.lng-a.lng,(e>=180||-180>=e)&&(a.lat=90,i.lat=-90),(r>=180||-180>=r)&&(a.lng=-180,i.lng=180),o="&minmagnitude="+n+"&minlatitude="+i.lat+"&maxlatitude="+a.lat+"&minlongitude="+a.lng+"&maxlongitude="+i.lng+"&callback=updateQuakeCount"},t}(),r.exports=n}}),require.define({"2D/thisfolderisacomment/cross-section":function(t,e,r){var n,a;a=e("2D/extensions/custom-polyline"),n=function(){function t(t){var e;this.map=t,this._featureGroup=new L.LayerGroup,this._editMarkerGroup=new L.LayerGroup,this.map.addLayer(this._featureGroup),this.map.addLayer(this._editMarkerGroup),e=new a(this.map),e.enable(),this._line=new L.Polyline([],this.lineOptions),this._rect=new L.polygon([]),this.map.on("draw:created",function(t){return function(e){return t.handleCreate(e)}}(this))}return t.prototype.width=1.5,t.prototype.lineOptions={stroke:!0,color:"#ff0000",weight:4,opacity:.5,fill:!1,clickable:!0},t.prototype.points=[],t.prototype._featureGroup=null,t.prototype._line=null,t.prototype._rect=null,t.prototype.handleCreate=function(t){var e,r,n;return n=t.layer.getLatLngs(),e=n[0],r=n[1],this._updateLine(e,r),this._updateRect(e,r),this._createEditControls(),this.current={center:this.map.getCenter(),zoom:this.map.getZoom()},null!=this._rect?this.map.fitBounds(this._rect.getBounds()):void 0},t.prototype.destroy=function(){return this.map.removeLayer(this._featureGroup),this.map.removeLayer(this._editMarkerGroup),this.map.setView(this.current.center,this.current.zoom)},t.prototype._updateLine=function(t,e){return this._line.setLatLngs([t,e]),this._featureGroup.hasLayer(this._line)||this._featureGroup.addLayer(this._line),this._line},t.prototype._updateRect=function(t,e){var r,n,a,i,o,s,u,l,p,c,d,h,f,m;return r=this.map.latLngToContainerPoint(t),n=this.map.latLngToContainerPoint(e),s=this._direction(r,n),o=this.width*Math.cos(s+Math.PI/2),i=this.width*Math.sin(s+Math.PI/2),c=L.latLng(t.lat+i,t.lng+o),a=this.map.latLngToContainerPoint(c),u=r.distanceTo(a),l=u*Math.cos(s+Math.PI/2),p=u*Math.sin(s+Math.PI/2),d=r.add(L.point(l,p)),h=r.add(L.point(-l,-p)),f=n.add(L.point(-l,-p)),m=n.add(L.point(l,p)),this.points=[this.map.containerPointToLatLng(d),this.map.containerPointToLatLng(h),this.map.containerPointToLatLng(f),this.map.containerPointToLatLng(m)],this._rect.setLatLngs(this.points),this._featureGroup.hasLayer(this._rect)||this._featureGroup.addLayer(this._rect),this._rect},t.prototype._direction=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},t.prototype._midPoint=function(t,e){var r,n;return r=e.lng-t.lng,n=e.lat-t.lat,L.latLng(t.lat+n/2,t.lng+r/2)},t.prototype._createEditControls=function(){var t,e,r,n;return e=this._createEditMarker(this._line.getLatLngs()[0],function(e){return function(n){return e._updateLine(n.target.getLatLng(),e._line.getLatLngs()[1]),e._updateRect(n.target.getLatLng(),e._line.getLatLngs()[1]),t.updateLocation(e._rect.getBounds().getCenter()),r.updateLocation(e._midPoint(e._rect.getLatLngs()[0],e._rect.getLatLngs()[3]))}}(this)),n=this._createEditMarker(this._line.getLatLngs()[1],function(e){return function(n){return e._updateLine(e._line.getLatLngs()[0],n.target.getLatLng()),e._updateRect(e._line.getLatLngs()[0],n.target.getLatLng()),t.updateLocation(e._rect.getBounds().getCenter()),r.updateLocation(e._midPoint(e._rect.getLatLngs()[0],e._rect.getLatLngs()[3]))}}(this)),t=this._createEditMarker(this._midPoint.apply(this,this._line.getLatLngs()),function(a){return function(i){var o,s,u,l,p,c,d;return u=i.target.getLatLng(),o=u.lng-t._origLatLng.lng,s=u.lat-t._origLatLng.lat,d=a._line.getLatLngs(),l=d[0],p=d[1],l.lat+=s,l.lng+=o,p.lat+=s,p.lng+=o,a._updateLine(l,p),a._updateRect(l,p),e.updateLocation(l),n.updateLocation(p),c=r.getLatLng(),c.lat+=s,c.lng+=o,r.setLatLng(c),t._origLatLng=u}}(this)),r=this._createEditMarker(this._midPoint(this._rect.getLatLngs()[0],this._rect.getLatLngs()[3]),function(e){return function(r){var n,a,i,o,s,u,l;return i=r.target.getLatLng(),n=t.getLatLng(),l=e._line.getLatLngs(),s=l[0],u=l[1],o=Math.abs((u.lat-s.lat)*i.lng-(u.lng-s.lng)*i.lat+u.lng*s.lat-u.lat*s.lng),a=Math.sqrt(Math.pow(u.lng-s.lng,2)+Math.pow(u.lat-s.lat,2)),e.width=o/a,console.log("new width: ",e.width,r.target.getLatLng(),t.getLatLng()),e._updateLine.apply(e,e._line.getLatLngs()),e._updateRect.apply(e,e._line.getLatLngs())}}(this))},t.prototype._createEditMarker=function(t,e){var r;return r=new L.Marker(t,{draggable:!0,icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})}),r._origLatLng=t,r.updateLocation=function(t){return this._origLatLng=t,this.setLatLng(t)},r.on("drag",e),r.on("dragend",e),this._editMarkerGroup.addLayer(r),r},t}(),r.exports=n}}),require.define({"2D/thisfolderisacomment/magnitude-search":function(t,e,r){var n;n=function(){function t(){}return t.prototype.loadMagArray=function(){return new Promise(function(t){return function(e,r){return $.get("count.txt",function(r){var n,a,i,o,s,u;for(n=r.split(","),t.magarray=[],a=o=99;o>=0;a=--o)for(magarray[a]=[],i=s=0,u=n.length/102;u>s;i=s+=1)null!=t.magarray[a][i]?magarray[a][i]=parseInt(n[102*i+2+a])+magarray[a][i]:magarray[a][i]=parseInt(n[102*i+2+a]),i+1<n.length/102&&(magarray[a][i+1]=parseInt(magarray[a][i])),99>a&&(magarray[a][i]=parseInt(magarray[a+1][i])+magarray[a][i]);return e()})}}(this))},t.prototype.loadCount=function(t){return $("#error-date").html(""),null==this.magArray&&this.loadMagArray().then(function(e){return function(){return e.loadCount(t)}}(this)),this.d1={year:$("#date-1-y").val(),month:$("#date-1-m").val()},this.d2={year:$("#date-2-y").val(),month:$("#date-2-m").val()},0!==t||null!=this.d1.year&&null!=this.d2.year?(this.d1.year=this.d1.year-60,this.d1.month=this.d1.month-1,this.d2.year=this.d2.year-60,this.d1.month=this.d2.month-1,12*this.d2.year+this.d2.month<=12*this.d1.year+this.d1.month?void $("#error-date").html("<p style='color:red'>Select a valid date range</p>"):0===t?window.open("?mag="+this._binarySearch(0,100)+"&startdate="+(this.d1.year+1960)+"-"+(this.d1.month+1)+"-1&enddate="+(this.d2.year+1960)+"-"+(this.d2.month+1)+"-1","_self"):$("#magnitude-search").html("<p>Calculated magnitude cutoff : </p><p style='color:green'>"+this._binarySearch(0,100)+"</p>")):void $("#error-date").html("<p style='color:red'>Select the years</p>")},t.prototype._binarySearch=function(t,e){var r,n;return e>t?(r=0,r=this.magArray[t][12*d2.year+d2.month]-this.magArray[t][12*d1.year+d1.month],r>2e4?(n=t+(e-t)/2,binarySearch(n,e)):15e3>r&&0!==t?(n=t-(e-t)/2,binarySearch(n,t)):t/10):e/10},t}(),r.exports=new n}}),require.define({"2D/thisfolderisacomment/map-controller":function(t,e,r){var n,a;n=e("common/data-loader"),a=function(){function t(t){this.map=t,this.map.controller=this,this.util=e("common/util"),this.values={}}return t.EARTHQUAKE_NUM_LIMIT=500,t.prototype.values={timediff:0,size:0},t.prototype.earthquakes={circles:[],time:[],depth:[]},t.prototype.timeLine=null,t.prototype.speed=360,t.prototype.snd=new Audio("tap.wav"),t.prototype._getDepth=function(t){var e,r,n;try{return t.geometry.geometries[0].coordinates[2]}catch(r){e=r}try{return t.geometry.coordinates[2]}catch(n){e=n}return console.log("Failed to find depth!",t),"???"},t.prototype._getCurrentLimit=function(e,r){return t.EARTHQUAKE_NUM_LIMIT},t.prototype._getCurrentMag=function(t){var e;return e=this._getDesiredMag(t),this.map.parameters.mag!==e&&(this.map.parameters.mag=e,$("#magnitude-slider").val(e).slider("refresh")),e},t.prototype._getDesiredMag=function(t){return null!=this.map.parameters.desiredMag?this.map.parameters.desiredMag:t>8?2:t>6?3:t>3?4:t>1?5:6},t.prototype._geojsonURL=function(t){var e,r,n,a,i,o,s,u,l;return null!=t?(s=t.tileSize,o=L.point(t.x,t.y),n=o.multiplyBy(s),i=n.add(new L.Point(s,s)),r=this.map.leafletMap.unproject(n),a=this.map.leafletMap.unproject(i),l=t.z):(e=this.map.leafletMap.getBounds(),null!=this.map.parameters.nw?r=this.map.parameters.nw:null!=this.map.parameters.center&&null!=this.map.parameters.zoom&&(r=e.getNorthWest()),
null!=this.map.parameters.se?a=this.map.parameters.se:null!=this.map.parameters.center&&null!=this.map.parameters.zoom&&(a=e.getSouthEast()),s=256,l=0),u="&limit="+this._getCurrentLimit(l,s)+"&jsonerror=true&minmagnitude="+this._getCurrentMag(l)+"&starttime="+this.map.parameters.startdate+"&endtime="+this.map.parameters.enddate,null!=r&&null!=a&&(u+="&minlatitude="+a.lat+"&maxlatitude="+r.lat+"&minlongitude="+r.lng+"&maxlongitude="+a.lng),u},t.prototype._updateSlider=function(){return $("#slider").val(Math.ceil(this.timeLine.progress()*this.map.values.timediff)).slider("refresh"),$("#date").html(this.util.timeConverter(this.timeLine.progress()*this.map.values.timediff+this.map.parameters.starttime))},t.prototype._markerStyle={clickable:!0,color:"#000",fillColor:"#00D",weight:1,opacity:1,fillOpacity:.3},t.prototype._markerCreator=function(){return{pointToLayer:function(t){return function(e,r){return L.circleMarker(r,t._markerStyle)}}(this),style:this._markerStyle,onEachFeature:function(t){return function(e,r){var n;return n=t._getDepth(e),r.setStyle({radius:.9*Math.pow(1.5,e.properties.mag-1),fillColor:"#"+t.rainbow.colourAt(n)}),null!=e.properties&&r.bindPopup("Place: <b>"+e.properties.place+"</b></br>Magnitude: <b> "+e.properties.mag+"</b></br>Time: "+t.util.timeConverter(e.properties.time)+"</br>Depth: "+n+" km"),r instanceof L.Point?void 0:(r.on("mouseover",function(){return r.setStyle({fillOpacity:1})}),r.on("mouseout",function(){return r.setStyle({fillOpacity:.3})}))}}(this)}},t.prototype.initController=function(){var t;return this.rainbow=new Rainbow,this.rainbow.setNumberRange(0,700),this.timeLine=new TimelineLite({onUpdate:function(t){return function(){return t._updateSlider()}}(this)}),t={lines:13,length:10,width:7,radius:10,top:"37px",left:"70px",color:"#cccccc",shadow:!0},this.map.parameters.timeline?this._loadStaticData(t):(this.geojsonTileLayer=new L.TileLayer.GeoJSON("http://earthquake.usgs.gov/fdsnws/event/1/query?eventtype=earthquake&orderby=magnitude&format=geojson{url_params}",{url_params:function(t){return function(e){return t._geojsonURL(e)}}(this),clipTiles:!1,wrapPoints:!1},this._markerCreator()),this.geojsonTileLayer.on("loading",function(e){return function(r){return e.map.leafletMap.spin(!0,t)}}(this)),this.geojsonTileLayer.on("load",function(t){return function(e){return t.map.leafletMap.spin(!1)}}(this)),this.geojsonTileLayer.addTo(this.map.leafletMap))},t.prototype.reloadData=function(){var t,e,r,n;if(this.map.parameters.timeline){for(this.timeLine.pause(),n=this.map.earthquakes.circles,e=0,r=n.length;r>e;e++)t=n[e],this.map.leafletMap.hasLayer(t)&&this.map.leafletMap.removeLayer(t);return this.map.earthquakes.circles=[],this.map.earthquakes.time=[],this.map.earthquakes.depth=[],this._loadStaticData()}return this.geojsonTileLayer.redraw()},t.prototype._loadStaticData=function(t){var e,r;return this.timeLine.pause(),e=new n,r=null!=this.map.parameters.data?e.load(this.map.parameters.data,{ajax:!0}):null!=this.map.parameters.datap&&null!=this.map.parameters.datap_callback?e.load(this.map.parameters.datap,{callback:this.map.parameters.datap_callback}):e.load("http://earthquake.usgs.gov/fdsnws/event/1/query?eventtype=earthquake&orderby=time-asc&format=geojson"+this._geojsonURL(),{ajax:!0}),r.then(function(t){return function(e){var r,n,a,i,o,s;for(t.map.values.size=e.features.length,s=e.features,a=i=0,o=s.length;o>i;a=++i)n=s[a],t.map.earthquakes.circles[a]=L.geoJson(n,t._markerCreator()),t.map.earthquakes.time[a]=n.properties.time,t.map.earthquakes.depth[a]=n.geometry.coordinates[2],r=0===a?0:20*((n.properties.time-e.features[a-1].properties.time)/1e9),t.timeLine.append(TweenLite.delayedCall(r,function(e){return t.map.mapAdder(e)},[a.toString()]));return t.map.values.size>0?(t.map.values.timediff=e.features[t.map.values.size-1].properties.time-e.features[0].properties.time,t.map.parameters.starttime=e.features[0].properties.time,$("#slider").slider({slidestart:function(e){return t.timeLine.pause()},slidestop:function(e){return $("#date").html(t.util.timeConverter(t.map.parameters.starttime)),t.timeLine.progress($("#slider").val()/t.map.values.timediff)}}),$("#info").html("<p>\ntotal earthquakes: "+t.map.values.size+"<br/>\nminimum depth: "+Math.min.apply(null,t.map.earthquakes.depth)+" km</br>\nmaximum depth: "+Math.max.apply(null,t.map.earthquakes.depth)+" km\n</p>\n<div class='ui-body ui-body-a'><p>\n  <a href='http://github.com/gizmoabhinav/Seismic-Eruptions'>Link to the project</a>\n</p></div>"),$("#startdate").html("Start date: "+t.util.timeConverter(t.map.parameters.startdate)),$("#enddate").html("End date: "+t.util.timeConverter(t.map.parameters.enddate)),$("#magcutoff").html("Cutoff magnitude: "+t.map.parameters.mag),t.timeLine.resume()):void 0}}(this))},t}(),r.exports=a}}),require.define({"2D/thisfolderisacomment/map":function(t,e,r){var n,a,i;n=e("2D/cross-section"),i=e("common/util"),a=function(){function t(){var t,e,r;r=new Date,null==this.parameters.startdate&&(this.parameters.startdate="1960/1/1"),null==this.parameters.enddate&&(this.parameters.enddate=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()),this.parameters.timeline=!0,null!=this.parameters.center&&this.parameters.zoom||((t=this.parameters).nw||(t.nw=L.latLng(50,-40)),(e=this.parameters).se||(e.se=L.latLng(-20,40)))}var e;return t.prototype.leafletMap=L.map("map",{worldCopyJump:!0}),t.prototype.crossSection=null,t.prototype.parameters={desiredMag:i.getURLParameter("mag"),startdate:i.getURLParameter("startdate"),enddate:i.getURLParameter("enddate"),nw:(e=i.getURLParameter("nw"))?L.latLng.apply(L,e.split(",")):null,se:(e=i.getURLParameter("se"))?L.latLng.apply(L,e.split(",")):null,center:(e=i.getURLParameter("center"))?L.latLng.apply(L,e.split(",")):null,zoom:i.getURLParameter("zoom"),data:i.getURLParameter("data"),datap:i.getURLParameter("datap"),datap_callback:i.getURLParameter("datap_callback")},t.prototype.values={timediff:0,size:0,maxdepth:0,mindepth:2e3},t.prototype.layers={baseLayer3:L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{}),baseLayer2:L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",{subdomains:["otile1","otile2","otile3","otile4"]}),baseLayer1:L.tileLayer("http://{s}.tiles.mapbox.com/v3/bclc-apec.map-rslgvy56/{z}/{x}/{y}.png",{})},t.prototype.drawnItems=new L.FeatureGroup,t.prototype.earthquakes={circles:[],time:[],depth:[]},t.prototype.array=[],t.prototype.plateBoundaries=new L.KML("plates.kml",{async:!0}),t.prototype.plateToggle=function(){return $("#plates").is(":checked")?this.leafletMap.addLayer(this.plateBoundaries):this.leafletMap.removeLayer(this.plateBoundaries)},t.prototype.mapAdder=function(t){for(this.leafletMap.hasLayer(this.earthquakes.circles[t])||this.earthquakes.circles[t].addTo(this.leafletMap),this.earthquakes.circles[t].setStyle({fillOpacity:.5,fillColor:"#"+this.controller.rainbow.colourAt(this.earthquakes.depth[t])}),t++;this.leafletMap.hasLayer(this.earthquakes.circles[t]);)this.leafletMap.removeLayer(this.earthquakes.circles[t]),t++;return $("#time").html(i.timeConverter(this.earthquakes.time[t])),this.controller.snd.play()},t.prototype.mapRemover=function(t){return this.leafletMap.hasLayer(this.earthquakes.circles[t])?this.leafletMap.removeLayer(this.earthquakes.circles[t]):void 0},t.prototype.render=function(){var t;return t=this.crossSection.points,4===t.length?this.render3DFrame("../3D/index.html?x1="+t[0].lng+"&y1="+t[0].lat+"&x2="+t[1].lng+"&y2="+t[1].lat+"&x3="+t[2].lng+"&y3="+t[2].lat+"&x4="+t[3].lng+"&y4="+t[3].lat+"&mag="+this.parameters.mag+"&startdate="+this.parameters.startdate+"&enddate="+this.parameters.enddate):void 0},t.prototype.render3DFrame=function(t){var e;return e=document.createElement("div"),e.className="crosssection-popup",e.innerHTML="<div class='close-button'><span class='ui-btn-icon-notext ui-icon-delete'></span></div><div class='iframe-wrapper'><iframe class='crosssection-iframe' src='"+t+"'></iframe></div>",document.body.appendChild(e),$(".close-button").click(function(){return document.body.removeChild(e)})},t.prototype.startdrawing=function(){return null!=this.crossSection?void alert("Click done on the current cross-section before drawing a new cross-section"):this.crossSection=new n(this.leafletMap)},t.prototype.backtonormalview=function(){return this.crossSection.destroy(),this.crossSection=null},t}(),r.exports=a}}),require.define({"common/data-loader":function(t,e,r){var n;n=function(){function t(){}return t.prototype.load=function(t,e){var r,n,a;return a=null!=e?e:{},r=a.ajax,n=a.callback,new Promise(function(e){return function(a,i){var o,s;return r?$.ajax({url:t,dataType:"json",success:function(t){return a(t)},error:function(t){return i(t)}}):(o=null!=n?n:"request_"+Math.random().toString(36).substr(2,8),s=e.injectScript(o,t,null==n),e.createListener(o,s,a,i),document.body.appendChild(s))}}(this))},t.prototype.createListener=function(t,e,r,n){return window[t]=function(n){return document.body.removeChild(e),delete window[t],r(n)}},t.prototype.injectScript=function(t,e,r){var n;return null==r&&(r=!0),n=document.createElement("script"),n.src=e+(r?"&callback="+t:""),n.id=t,n},t}(),r.exports=n}}),require.define({"common/util":function(t,e,r){var n,a={}.hasOwnProperty;n=function(){function t(){}return t.prototype.getURLParameter=function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null},t.prototype.convertCoordinatesx=function(t){return t=parseFloat(t),t=64*(t+180)/360},t.prototype.convertCoordinatesy=function(t){return t=parseFloat(t),t*=Math.PI/180,t=32*(1-Math.log(Math.tan(t)+1/Math.cos(t))/Math.PI)},t.prototype.toLon=function(t){return t=parseFloat(t),t=360*t/64-180},t.prototype.toLat=function(t){return t=parseFloat(t),t=2*(Math.atan(Math.pow(Math.E,(1-t/32)*Math.PI))-Math.PI/4),t=180*t/Math.PI},t.prototype._months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t.prototype.timeConverter=function(t){var e,r,n,a,i;return e=new Date(t),i=e.getFullYear(),n=this._months[e.getMonth()],r=e.getDate(),a=i+" "+n+" "+r},t.prototype.usgsDate=function(t){return t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()},t.prototype.queryString=function(t,e){var r,n,i,o;null==e&&(e={}),r=t.leafletMap.getCenter(),i={zoom:t.leafletMap.getZoom(),center:r.lat+","+r.lng,mag:t.parameters.desiredMag,startdate:t.parameters.startdate,enddate:t.parameters.enddate},t.parameters.timeline&&(i.timeline=!0);for(n in e)a.call(e,n)&&(o=e[n],i[n]=o);return"?"+$.param(i)},t}(),r.exports=new n}});