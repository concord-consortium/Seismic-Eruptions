function loadCount(e){return"null"!=$("#date-1-y").val()&&"null"!=$("#date-2-y").val()||0!=e?($("#error-date").html(""),month1=parseInt($("#date-1-m").val()-1),year1=parseInt($("#date-1-y").val())-60,month2=parseInt($("#date-2-m").val()-1),year2=parseInt($("#date-2-y").val())-60,12*parseInt(year2)+parseInt(month2)<=12*parseInt(year1)+parseInt(month1)?void $("#error-date").html("<p style='color:red'>Select a valid date range</p>"):($("#error-date").html(""),void(0==e?window.open("http://gizmoabhinav.github.io/Seismic-Eruptions/?mag="+binarySearch(0,100)+"&startdate="+(parseInt(year1)+1960)+"-"+(parseInt(month1)+1)+"-1&enddate="+(parseInt(year2)+1960)+"-"+(parseInt(month2)+1)+"-1","_self"):$("#magnitude-search").html("<p>Calculated magnitude cutoff : </p><p style='color:green'>"+binarySearch(0,100)+"</p>")))):void $("#error-date").html("<p style='color:red'>Select the years</p>")}function binarySearch(e,t){if(t>e){var a=0;return a=parseInt(magarray[parseInt(e)][12*parseInt(year2)+parseInt(month2)])-parseInt(magarray[parseInt(e)][12*parseInt(year1)+parseInt(month1)]),parseInt(a)>2e4?binarySearch(parseInt(e)+(t-parseInt(e))/2,t):parseInt(a)<15e3&&0!=e?binarySearch(parseInt(e)-(t-parseInt(e))/2,e):parseInt(e)/10}}function convertCoordinatesx(e){return e=parseFloat(e),e=64*(e+180)/360}function convertCoordinatesy(e){return e=parseFloat(e),e*=Math.PI/180,e=32*(1-Math.log(Math.tan(e/2+Math.PI/4))/Math.PI)}function toLon(e){return e=parseFloat(e),e=360*e/64-180}function toLat(e){return e=parseFloat(e),e=2*(Math.atan(Math.pow(Math.E,(1-e/32)*Math.PI))-Math.PI/4),e=180*e/Math.PI}function Rainbow(){function e(e){if(e.length<2)throw new Error("Rainbow must have two or more colours.");var n=(r-a)/(e.length-1),o=new ColourGradient;o.setGradient(e[0],e[1]),o.setNumberRange(a,a+n),t=[o];for(var s=1;s<e.length-1;s++){var l=new ColourGradient;l.setGradient(e[s],e[s+1]),l.setNumberRange(a+n*s,a+n*(s+1)),t[s]=l}return i=e,this}var t=null,a=0,r=100,i=["ff0000","ffff00","00ff00","0000ff"];e(i),this.setColors=this.setColours,this.setSpectrum=function(){return e(arguments),this},this.setSpectrumByArray=function(t){return e(t),this},this.colourAt=function(e){if(isNaN(e))throw new TypeError(e+" is not a number");if(1===t.length)return t[0].colourAt(e);var i=(r-a)/t.length,n=Math.min(Math.floor((Math.max(e,a)-a)/i),t.length-1);return t[n].colourAt(e)},this.colorAt=this.colourAt,this.setNumberRange=function(t,n){if(!(n>t))throw new RangeError("maxNumber ("+n+") is not greater than minNumber ("+t+")");return a=t,r=n,e(i),this}}function ColourGradient(){function e(e,t,a){var r=e;n>r&&(r=n),r>o&&(r=o);var i=o-n,s=parseInt(t,16),l=parseInt(a,16),h=(l-s)/i,c=Math.round(h*(r-n)+s);return formatHex(c.toString(16))}function t(e){var t=/^#?[0-9a-fA-F]{6}$/i;return t.test(e)}function a(e){if(t(e))return e.substring(e.length-6,e.length);for(var a=[["red","ff0000"],["lime","00ff00"],["blue","0000ff"],["yellow","ffff00"],["orange","ff8000"],["aqua","00ffff"],["fuchsia","ff00ff"],["white","ffffff"],["black","000000"],["gray","808080"],["grey","808080"],["silver","c0c0c0"],["maroon","800000"],["olive","808000"],["green","008000"],["teal","008080"],["navy","000080"],["purple","800080"]],r=0;r<a.length;r++)if(e.toLowerCase()===a[r][0])return a[r][1];throw new Error(e+" is not a valid colour.")}var r="ff0000",i="0000ff",n=0,o=100;this.setGradient=function(e,t){r=a(e),i=a(t)},this.setNumberRange=function(e,t){if(!(t>e))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+e+")");n=e,o=t},this.colourAt=function(t){return e(t,r.substring(0,2),i.substring(0,2))+e(t,r.substring(2,4),i.substring(2,4))+e(t,r.substring(4,6),i.substring(4,6))},formatHex=function(e){return 1===e.length?"0"+e:e}}var polygonArr=new Array,lng0,lng1,lat0,lat1,touchstart=!0,touchend=!1,width=.25,linelength=0,length,ratio1,ratio2,x1,y1,x2,y2,x3,y3,x4,y4,lat,lng,mlat,mlng,mlatlng,initDistance,initWidth,resizemarkervar,movemarkervar,endmarker1,endmarker2,CrossSection=L.Class.extend({options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:10,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#ff0000",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3},enable:function(){this._enabled||(this._enabled=!0)},disable:function(){this._enabled&&(this_enabled=!1)},initialize:function(e){this._crossSection={line:{},rectangle:{}},this._map=e,this._container=e._container,this._overlayPane=e._panes.overlayPane,this._popupPane=e._panes.popupPane,this._featureGroup=new L.FeatureGroup,this._drawGuide(new L.Point(0,0),new L.Point(0,0)),this.addHooks()},addHooks:function(){this._map&&(this._map.getContainer().focus(),L.DomUtil.disableTextSelection(),this._tooltip=new L.Tooltip(this._map),this._map.getContainer().focus(),this._markers=[],this._map.dragging.disable(),this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._crossSection.line=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),L.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._map._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.on(this._map._container,"touchmove",this._onTouchMove,this),console.log("here"),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).on("touchstart",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomlevelschange",this._onZoomEnd,this))},removeHooks:function(){L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,this._clearHideErrorTimeout(),this._map.dragging.enable(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseup",this._onMouseUp,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),L.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._map._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._map._container,"touchmove",this._onTouchMove,this),this._map.off("mousemove",this._onMouseMove,this).off("mouseup",this._onMouseUp,this).off("zoomlevelschange",this._onZoomEnd,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var e=this._markers.pop(),t=this._crossSection.line,a=this._crossSection.line.spliceLatLngs(t.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(e),t.getLatLngs().length<2&&this._map.removeLayer(t),this._vertexChanged(a,!1)}},addVertex:function(e){var t=this._markers.length;return t>0&&!this.options.allowIntersection?void this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._crossSection.line.addLatLng(e),2==this._crossSection.line.getLatLngs().length&&(this._map.addLayer(this._crossSection.line),this._finishShape()),void(2==t?(polygonArr[1]=e,lat0=convertCoordinatesy(polygonArr[0].lat),lat1=convertCoordinatesy(polygonArr[1].lat),lng0=convertCoordinatesx(polygonArr[0].lng),lng1=convertCoordinatesx(polygonArr[1].lng),length=Math.sqrt(Math.pow(lat0-lat1,2)+Math.pow(lng0-lng1,2)),ratio1=length/(lat0-lat1),ratio2=length/(lng0-lng1),x1=lat1+width/ratio2,y1=lng1-width/ratio1,x2=lat0+width/ratio2,y2=lng0-width/ratio1,x3=lat0-width/ratio2,y3=lng0+width/ratio1,x4=lat1-width/ratio2,y4=lng1+width/ratio1,this._crossSection.rectangle=new L.polygon([[toLat(x1),toLon(y1)],[toLat(x2),toLon(y2)],[toLat(x3),toLon(y3)],[toLat(x4),toLon(y4)]]),this._crossSection.rectangle.addTo(this._map),this._map.fitBounds(this._crossSection.rectangle.getBounds()),this._clearGuides(),this.removeHooks(),this._featureGroup.addLayer(this._crossSection.line),this._featureGroup.addLayer(this._crossSection.rectangle)):(polygonArr=new Array,polygonArr[0]=e,this._map.hasLayer(this._crossSection.line)&&this._map.removeLayer(this._crossSection.line),this._map.hasLayer(this._crossSection.rectangle)&&this._map.removeLayer(this._crossSection.rectangle))))},_finishShape:function(){return this.options.allowIntersection&&this._shapeIsValid()?(this._fireCreatedEvent(),this.disable(),void(this.options.repeatMode&&this.enable())):void this._showErrorTooltip()},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(e){var t=e.layerPoint,a=e.latlng;this._currentLatLng=a,this._updateTooltip(a),this._updateGuide(t),this._mouseMarker.setLatLng(a),L.DomEvent.preventDefault(e.originalEvent)},_vertexChanged:function(e,t){this._updateFinishHandler(),this._updateRunningMeasure(e,t),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(e){var t=e.originalEvent;this._mouseDownOrigin=L.point(t.clientX,t.clientY),this._markers=[],this._markers.push(this._createMarker(e.latlng)),this.addVertex(e.latlng)},_onMouseUp:function(e){if(this._mouseDownOrigin){{L.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin)}this._markers[1]=this._createMarker(e.latlng),this.addVertex(e.latlng)}this._mouseDownOrigin=null},_onTouchStart:function(e){touchstart&&(this._mouseDownOrigin=L.point(e.changedTouches[0].clientX,e.changedTouches[0].clientY),this._markers=[],this._markers[0]=this._createMarker(this._map.layerPointToLatLng(this._mouseDownOrigin)),this.addVertex(this._map.layerPointToLatLng(this._mouseDownOrigin)),touchstart=!1,touchend=!0)},_onTouchEnd:function(e){if(touchend){if(this._mouseDownOrigin){var t=(L.point(e.changedTouches[0].clientX,e.changedTouches[0].clientY).distanceTo(this._mouseDownOrigin),this._map.layerPointToLatLng(L.point(e.changedTouches[0].clientX,e.changedTouches[0].clientY)));this._markers[1]=this._createMarker(t),this.addVertex(t),touchend=!1}this._mouseDownOrigin=null,touchstart=!0}},_onTouchMove:function(e){this._currentLatLng=this._map.layerPointToLatLng(L.point(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),this._updateTooltip(this._map.layerPointToLatLng(L.point(e.changedTouches[0].clientX,e.changedTouches[0].clientY))),this._updateGuide(L.point(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),this._mouseMarker.setLatLng(this._map.layerPointToLatLng(L.point(e.changedTouches[0].clientX,e.changedTouches[0].clientY)))},_updateFinishHandler:function(){var e=this._markers.length;e>1&&this._markers[e-1].on("click",this._finishShape,this),e>2&&this._markers[e-2].off("click",this._finishShape,this)},_createMarker:function(e){var t=new L.Marker(e,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(t),t},_updateGuide:function(e){if(null!=this._markers)var t=this._markers.length;else var t=0;t>0&&2>t&&(e=e||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[0].getLatLng()),e))},_updateTooltip:function(e){var t=this._getTooltipText();e&&this._tooltip.updatePosition(e),this._errorShown||this._tooltip.updateContent(t)},_drawGuide:function(e,t){var a,r,i,n=Math.floor(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))),o=this.options.guidelineDistance,s=this.options.maxGuideLineLength,l=n>s?n-s:o;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));n>l;l+=this.options.guidelineDistance)a=l/n,r={x:Math.floor(e.x*(1-a)+a*t.x),y:Math.floor(e.y*(1-a)+a*t.y)},i=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),i.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(i,r)},_updateGuideColor:function(e){if(this._guidesContainer)for(var t=0,a=this._guidesContainer.childNodes.length;a>t;t++)this._guidesContainer.childNodes[t].style.backgroundColor=e},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var e,t,a=this.options.showLength;return 0===this._markers.length?e={text:"Click and drag to start drawing line."}:(t=a?this._getMeasurementString():"",linelength=parseInt(t.substr(0,t.length-4)),e=1===this._markers.length?parseInt(t.substr(0,t.length-4))>1400?{text:"Drag to continue drawing shape.",subtext:t+" Create a smaller cross section for better view"}:{text:"Drag to continue drawing shape.",subtext:t}:{text:"Drag",subtext:t}),e},_updateRunningMeasure:function(e,t){var a,r,i=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(a=i-(t?2:1),r=e.distanceTo(this._markers[0].getLatLng()),this._measurementRunningTotal+=r*(t?1:-1))},_getMeasurementString:function(){var e,t=this._currentLatLng,a=this._markers[0].getLatLng();return e=t.distanceTo(a),this.readableDistance(e,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._crossSection.line.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._crossSection.line.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){new L.Polyline(this._crossSection.line.getLatLngs(),this.options.shapeOptions)},readableDistance:function(e,t){var a;return t?a=e>1e3?(e/1e3).toFixed(2)+" km":Math.ceil(e)+" m":(e*=1.09361,a=e>1760?(e/1760).toFixed(2)+" miles":Math.ceil(e)+" yd"),a},editAddHooks:function(){this._map&&(this._editMarkerGroup||this._editInitMarkers(),this._map.addLayer(this._editMarkerGroup))},editRemoveHooks:function(){this._map&&(this._map.hasLayer(this._editMarkerGroup)&&this._map.removeLayer(this._editMarkerGroup),delete this._editMarkerGroup,delete this._editMarkers)},editUpdateMarkers:function(){this._editMarkerGroup.clearLayers(),this._editInitMarkers()},_editInitMarkers:function(){this._editMarkerGroup||(this._editMarkerGroup=new L.LayerGroup),this._editMarkers=[];var e,t,a,r,i=this._crossSection.line.getLatLngs();for(e=0,a=i.length;a>e;e++)r=this._editCreateMarker(i[e],e),r.on("click",this._editOnMarkerClick,this),this._editMarkers.push(r);var n,o;for(e=0,t=a-1;a>e;t=e++)(0!==e||L.Polygon&&this._crossSection.line instanceof L.Polygon)&&(n=this._editMarkers[t],o=this._editMarkers[e],endmarker1=n,endmarker2=o,this._editCreateResizeMarker(n,o),this._editCreateMoveMarker(n,o))},_editCreateMarker:function(e,t){var a=new L.Marker(e,{draggable:!0,icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})});return a._origLatLng=e,a._index=t,a.on("drag",this._editOnMarkerDrag,this),a.on("dragend",this._fireEdit,this),this._editMarkerGroup.addLayer(a),a},_editRemoveMarker:function(e){var t=e._index;this._editMarkerGroup.removeLayer(e),this._editMarkers.splice(t,1),this._crossSection.line.spliceLatLngs(t,1),this._updateIndexes(t,-1),e.off("drag",this._editOnMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._editOnMarkerClick,this)},_fireEdit:function(){this._crossSection.line.edited=!0,this._crossSection.line.fire("edit")},_editOnMarkerDrag:function(e){var t=e.target;this._map.removeLayer(this._crossSection.rectangle),L.extend(t._origLatLng,t._latlng);var a=this._map,r=a.project([toLat(x1),toLon(y1)]),i=a.project([toLat(x2),toLon(y2)]),n=a.unproject(a.project([toLat(lat0),toLon(lng0)])._add(a.project([toLat(lat1),toLon(lng1)]))._divideBy(2)),o=a.unproject(r._add(i)._divideBy(2));2==t._index&&5>=width&&(width=Math.sqrt(Math.pow(a.project(n).x-a.project(t.getLatLng()).x,2)+Math.pow(a.project(n).y-a.project(t.getLatLng()).y,2))*initWidth/initDistance),3==t._index&&(offset=[a.project(mlatlng).x-a.project(t._latlng).x,a.project(mlatlng).y-a.project(t._latlng).y],mlatlng=t._latlng,polygonArr[0]=a.unproject([a.project(polygonArr[0]).x-offset[0],a.project(polygonArr[0]).y-offset[1]]),polygonArr[1]=a.unproject([a.project(polygonArr[1]).x-offset[0],a.project(polygonArr[1]).y-offset[1]]),this._crossSection.line.setLatLngs([polygonArr[0],polygonArr[1]])),lat0=convertCoordinatesy(polygonArr[0].lat),lat1=convertCoordinatesy(polygonArr[1].lat),lng0=convertCoordinatesx(polygonArr[0].lng),lng1=convertCoordinatesx(polygonArr[1].lng),length=Math.sqrt(Math.pow(lat0-lat1,2)+Math.pow(lng0-lng1,2)),ratio1=length/(lat0-lat1),ratio2=length/(lng0-lng1),x1=lat1+width/ratio2,y1=lng1-width/ratio1,x2=lat0+width/ratio2,y2=lng0-width/ratio1,x3=lat0-width/ratio2,y3=lng0+width/ratio1,x4=lat1-width/ratio2,y4=lng1+width/ratio1,this._crossSection.rectangle=new L.polygon([[toLat(x1),toLon(y1)],[toLat(x2),toLon(y2)],[toLat(x3),toLon(y3)],[toLat(x4),toLon(y4)]]),this._crossSection.rectangle.addTo(this._map),resizemarkervar.setLatLng(o),movemarkervar.setLatLng(n),this._crossSection.line.redraw();var s=this.readableDistance(this._editMarkers[0]._latlng.distanceTo(this._editMarkers[1]._latlng),!0);linelength=parseInt(s.substr(0,s.length-4))},_editOnMarkerClick:function(e){var t=L.Polygon&&this._crossSection.line instanceof L.Polygon?4:3,a=e.target;this._crossSection.line.getLatLngs().length<t||(this._editRemoveMarker(a),this._editUpdatePrevNext(a._prev,a._next),a._middleLeft&&this._editMarkerGroup.removeLayer(a._middleLeft),a._middleRight&&this._editMarkerGroup.removeLayer(a._middleRight),a._prev&&marker._next?this._editCreateMiddleMarker(a._prev,a._next):a._prev?a._next||(a._prev._middleRight=null):a._next._middleLeft=null,this._fireEdit())},_editUpdateIndexes:function(e,t){this._editMarkerGroup.eachLayer(function(a){a._index>e&&(a._index+=t)})},_editCreateResizeMarker:function(){var e,t,a,r=this._map,i=r.project([toLat(x1),toLon(y1)]),n=r.project([toLat(x2),toLon(y2)]),o=r.unproject(r.project([toLat(lat0),toLon(lng0)])._add(r.project([toLat(lat1),toLon(lng1)]))._divideBy(2)),s=r.unproject(i._add(n)._divideBy(2)),l=this._editCreateMarker(s,2);resizemarkervar=l,l.setOpacity(.6),t=function(){lat=l.getLatLng().lat,lng=l.getLatLng().lng,initDistance=Math.sqrt(Math.pow(r.project(o).x-r.project(s).x,2)+Math.pow(r.project(o).y-r.project(s).y,2)),initWidth=width},a=function(){l.off("dragstart",t,this),l.off("dragend",a,this)},e=function(){t.call(this),a.call(this)},l.on("click",e,this).on("dragstart",t,this).on("dragend",a,this),this._editMarkerGroup.addLayer(l)},_editCreateMoveMarker:function(){var e,t,a,r=this._map,i=r.unproject(r.project([toLat(lat0),toLon(lng0)])._add(r.project([toLat(lat1),toLon(lng1)]))._divideBy(2)),n=this._editCreateMarker(i,3);movemarkervar=n,n.setOpacity(.6),t=function(){mlatlng=n.getLatLng(),mlat=n.getLatLng().lat,mlng=n.getLatLng().lng},a=function(){n.off("dragstart",t,this),n.off("dragend",a,this),this._editMarkerGroup.clearLayers(),this._editInitMarkers()},e=function(){t.call(this),a.call(this)},n.on("click",e,this).on("dragstart",t,this).on("dragend",a,this),this._editMarkerGroup.addLayer(n)},_editUpdatePrevNext:function(e,t){e&&(e._next=t),t&&(t._prev=e)},_editGetMiddleLatLng:function(e,t){var a=this._map,r=a.project(e.getLatLng()),i=a.project(t.getLatLng());return a.unproject(r._add(i)._divideBy(2))},removeCrossSection:function(){this._map.hasLayer(this._crossSection.line)&&this._map.removeLayer(this._crossSection.line),this._map.hasLayer(this._crossSection.rectangle)&&this._map.removeLayer(this._crossSection.rectangle)}});L.KML=L.FeatureGroup.extend({options:{async:!0},initialize:function(e,t){L.Util.setOptions(this,t),this._kml=e,this._layers={},e&&this.addKML(e,t,this.options.async)},loadXML:function(e,t,a,r){void 0==r&&(r=this.options.async),void 0==a&&(a=this.options);var i=new window.XMLHttpRequest;i.open("GET",e,r);try{i.overrideMimeType("text/xml")}catch(n){}i.onreadystatechange=function(){4==i.readyState&&200==i.status&&t(i.responseXML,a)},i.send(null)},addKML:function(e,t,a){var r=this,i=function(e,t){r._addKML(e,t)};this.loadXML(e,i,t,a)},_addKML:function(e){var t=L.KML.parseKML(e);if(t&&t.length){for(var a=0;a<t.length;a++)this.fire("addlayer",{layer:t[a]}),this.addLayer(t[a]);this.latLngs=L.KML.getLatLngs(e),this.fire("loaded")}},latLngs:[]}),L.Util.extend(L.KML,{parseKML:function(e){var t=this.parseStyle(e);this.parseStyleMap(e,t);for(var a,r=e.getElementsByTagName("Folder"),i=[],n=0;n<r.length;n++)this._check_folder(r[n])&&(a=this.parseFolder(r[n],t),a&&i.push(a));r=e.getElementsByTagName("Placemark");for(var o=0;o<r.length;o++)this._check_folder(r[o])&&(a=this.parsePlacemark(r[o],e,t),a&&i.push(a));return i},_check_folder:function(e,t){for(e=e.parentElement;e&&"Folder"!==e.tagName;)e=e.parentElement;return!e||e===t},parseStyle:function(e){function t(e){for(var a={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r],o=n.tagName;if(i[o])if("hotSpot"===o)for(var s=0;s<n.attributes.length;s++)a[n.attributes[s].name]=n.attributes[s].nodeValue;else{var l=n.childNodes[0].nodeValue;"color"===o?(a.opacity=parseInt(l.substring(0,2),16)/255,a.color="#"+l.substring(6,8)+l.substring(4,6)+l.substring(2,4)):"width"===o?a.weight=l:"Icon"===o?(c=t(n),c.href&&(a.href=c.href)):"href"===o&&(a.href=l)}}return a}for(var a={},r=e.getElementsByTagName("Style"),i={color:!0,width:!0,Icon:!0,href:!0,hotSpot:!0},n=0;n<r.length;n++){var o,s=r[n],l={},h={},c={};o=s.getElementsByTagName("LineStyle"),o&&o[0]&&(l=t(o[0])),o=s.getElementsByTagName("PolyStyle"),o&&o[0]&&(h=t(o[0])),h.color&&(l.fillColor=h.color),h.opacity&&(l.fillOpacity=h.opacity),o=s.getElementsByTagName("IconStyle"),o&&o[0]&&(c=t(o[0])),c.href&&(l.icon=new L.KMLIcon({iconUrl:c.href,shadowUrl:null,iconAnchorRef:{x:c.x,y:c.y},iconAnchorType:{x:c.xunits,y:c.yunits}})),a["#"+s.getAttribute("id")]=l}return a},parseStyleMap:function(e,t){for(var a=e.getElementsByTagName("StyleMap"),r=0;r<a.length;r++){var i,n,o,s=a[r];i=s.getElementsByTagName("key"),i&&i[0]&&(n=i[0].textContent),i=s.getElementsByTagName("styleUrl"),i&&i[0]&&(o=i[0].textContent),"normal"==n&&(t["#"+s.getAttribute("id")]=t[o])}},parseFolder:function(e,t){var a,r,i=[];a=e.getElementsByTagName("Folder");for(var n=0;n<a.length;n++)this._check_folder(a[n],e)&&(r=this.parseFolder(a[n],t),r&&i.push(r));a=e.getElementsByTagName("Placemark");for(var o=0;o<a.length;o++)this._check_folder(a[o],e)&&(r=this.parsePlacemark(a[o],e,t),r&&i.push(r));if(i.length)return 1===i.length?i[0]:new L.FeatureGroup(i)},parsePlacemark:function(e,t,a){var r,i,n,o={};for(n=e.getElementsByTagName("styleUrl"),r=0;r<n.length;r++){var s=n[r].childNodes[0].nodeValue;for(var l in a[s])o[l]=a[s][l]}var h=[],c=["LineString","Polygon","Point"];for(i in c){var d=c[i];for(n=e.getElementsByTagName(d),r=0;r<n.length;r++){var u=this["parse"+d](n[r],t,o);u&&h.push(u)}}if(h.length){var p=h[0];h.length>1&&(p=new L.FeatureGroup(h));var g,m="";for(n=e.getElementsByTagName("name"),n.length&&n[0].childNodes.length&&(g=n[0].childNodes[0].nodeValue),n=e.getElementsByTagName("description"),r=0;r<n.length;r++)for(i=0;i<n[r].childNodes.length;i++)m+=n[r].childNodes[i].nodeValue;return g&&p.bindPopup("<h2>"+g+"</h2>"+m),p}},parseCoords:function(e){var t=e.getElementsByTagName("coordinates");return this._read_coords(t[0])},parseLineString:function(e,t,a){var r=this.parseCoords(e);if(r.length)return new L.Polyline(r,a)},parsePoint:function(e,t,a){var r=e.getElementsByTagName("coordinates");if(r.length){var i=r[0].childNodes[0].nodeValue.split(",");return new L.KMLMarker(new L.LatLng(i[1],i[0]),a)}},parsePolygon:function(e,t,a){var r,i,n,o=[],s=[];for(r=e.getElementsByTagName("outerBoundaryIs"),i=0;i<r.length;i++)n=this.parseCoords(r[i]),n&&o.push(n);for(r=e.getElementsByTagName("innerBoundaryIs"),i=0;i<r.length;i++)n=this.parseCoords(r[i]),n&&s.push(n);return o.length?(a.fillColor&&(a.fill=!0),1===o.length?new L.Polygon(o.concat(s),a):new L.MultiPolygon(o,a)):void 0},getLatLngs:function(e){for(var t=e.getElementsByTagName("coordinates"),a=[],r=0;r<t.length;r++)a=a.concat(this._read_coords(t[r]));return a},_read_coords:function(e){var t,a="",r=[];for(t=0;t<e.childNodes.length;t++)a+=e.childNodes[t].nodeValue;for(a=a.split(/[\s\n]+/),t=0;t<a.length;t++){var i=a[t].split(",");i.length<2||r.push(new L.LatLng(i[1],i[0]))}return r}}),L.KMLIcon=L.Icon.extend({createIcon:function(){var e=this._createIcon("icon");return e.onload=function(){var t=e;this.style.width=t.width+"px",this.style.height=t.height+"px",("UNITS_FRACTION"===this.anchorType.x||"fraction"===this.anchorType.x)&&(e.style.marginLeft=-this.anchor.x*t.width+"px"),("UNITS_FRACTION"===this.anchorType.y||"fraction"===this.anchorType.x)&&(e.style.marginTop=-(1-this.anchor.y)*t.height+"px"),this.style.display=""},e},_setIconStyles:function(e,t){L.Icon.prototype._setIconStyles.apply(this,[e,t]),e.anchor=this.options.iconAnchorRef,e.anchorType=this.options.iconAnchorType}}),L.KMLMarker=L.Marker.extend({options:{icon:new L.KMLIcon.Default}}),L.LatLngUtil={cloneLatLngs:function(e){for(var t=[],a=0,r=e.length;r>a;a++)t.push(this.cloneLatLng(e[a]));return t},cloneLatLng:function(e){return L.latLng(e.lat,e.lng)}},L.Tooltip=L.Class.extend({initialize:function(e){this._map=e,this._popupPane=e._panes.popupPane,this._container=L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane),this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(e){return this._container?(e.subtext=e.subtext||"",0!==e.subtext.length||this._singleLineLabel?e.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(e.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+e.subtext+"</span><br />":"")+"<span>"+e.text+"</span>",this):(console.log("hello"),this)},updatePosition:function(e){var t=this._map.latLngToLayerPoint(e),a=this._container;return this._container&&(a.style.visibility="inherit",L.DomUtil.setPosition(a,t)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this}});var map2D=function(){function e(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function t(e){var t=new Date(e),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=t.getFullYear(),i=a[t.getMonth()],n=t.getDate(),o=(t.getHours(),t.getMinutes(),t.getSeconds(),r+" "+i+" "+n);return o}function a(){$.get("count.txt",function(e){array=e.split(","),console.log(array);var t=array.length;console.log(t),magarray=new Array;for(var a=99;a>=0;a--){magarray[a]=new Array;for(var r=0;t/102>r;r++)magarray[a][r]=void 0!=magarray[a][r]?parseInt(array[102*r+2+a])+parseInt(magarray[a][r]):parseInt(array[102*r+2+a]),t/102>r+1&&(magarray[a][r+1]=parseInt(magarray[a][r])),99>a&&(magarray[a][r]=parseInt(magarray[a+1][r])+parseInt(magarray[a][r]))}console.log(magarray)})}function r(){$("#slider").slider("value",o.timeLine.progress()*i.values.timediff),$("#date").html(t(o.timeLine.progress()*i.values.timediff+i.parameters.starttime))}var i={leafletMap:L.map("map"),crossSection:{},parameters:{mag:e("mag"),startdate:e("startdate"),enddate:e("enddate"),defaultInit:function(){var e=new Date;void 0==this.mag&&(this.mag=5),void 0==this.startdate&&(this.startdate="2009/1/1"),void 0==this.enddate&&(this.enddate=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate())}},values:{timediff:0,size:0,maxdepth:0,mindepth:2e3},layers:{baseLayer3:L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{}),baseLayer2:L.tileLayer("http://otile1.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",{}),baseLayer1:L.tileLayer("http://{s}.tiles.mapbox.com/v3/bclc-apec.map-rslgvy56/{z}/{x}/{y}.png",{})},drawnItems:new L.FeatureGroup,earthquakes:{circles:new Array,time:new Array,depth:new Array},array:new Array,magarray:{},editing:!1,plateBoundaries:new L.KML("plates.kml",{async:!0}),plateToggle:function(){$("#plates").is(":checked")?this.leafletMap.addLayer(this.plateBoundaries):this.leafletMap.removeLayer(this.plateBoundaries)},mapAdder:function(e){for(i.leafletMap.hasLayer(i.earthquakes.circles[e])||i.earthquakes.circles[e].addTo(i.leafletMap),i.earthquakes.circles[e].setStyle({fillOpacity:.5,fillColor:"#"+n.colourAt(i.earthquakes.depth[e])}),e++;i.leafletMap.hasLayer(i.earthquakes.circles[e]);)i.leafletMap.removeLayer(i.earthquakes.circles[e]),e++;$("#time").html(t(i.earthquakes.time[e])),o.snd.play()},mapRemover:function(e){i.leafletMap.hasLayer(i.earthquakes.circles[e])&&i.leafletMap.removeLayer(i.earthquakes.circles[e])},render:function(){return this.editing?void alert("Save edit before viewing the cross section"):0==linelength?void alert("Draw a cross-section first"):linelength>=1400?void alert("cross section too long"):void window.open("../3D/index.html?x1="+toLon(y1)+"&y1="+toLat(x1)+"&x2="+toLon(y2)+"&y2="+toLat(x2)+"&x3="+toLon(y3)+"&y3="+toLat(x3)+"&x4="+toLon(y4)+"&y4="+toLat(x4)+"&mag="+i.parameters.mag+"&startdate="+i.parameters.startdate+"&enddate="+i.parameters.enddate)},startdrawing:function(){return this.editing?void alert("Save edit before drawing a new cross-section"):void(this.crossSection=new CrossSection(i.leafletMap))},editdrawing:function(){this.editing=!0,this.crossSection.editAddHooks()},editsave:function(){this.editing=!1,this.crossSection.editRemoveHooks()},backtonormalview:function(){this.editing=!1,this.crossSection.editRemoveHooks(),this.crossSection.removeCrossSection()}},n=new Rainbow,o={timeLine:new TimelineLite({onUpdate:r}),speed:6,script:document.createElement("script"),snd:new Audio("tap.wav"),initController:function(){this.script.src="http://comcat.cr.usgs.gov/fdsnws/event/1/query?starttime="+i.parameters.startdate+"%0000:00:00&minmagnitude="+i.parameters.mag+"&format=geojson&callback=eqfeed_callback&endtime="+i.parameters.enddate+"%0000:00:00&orderby=time-asc",document.getElementsByTagName("body")[0].appendChild(this.script),window.eqfeed_callback=function(e){i.values.size=e.features.length;for(var a=0;a<i.values.size;a++)i.earthquakes.circles[a]=L.geoJson(e.features[a],{pointToLayer:function(t,r){return L.circleMarker(r,{radius:e.features[a].properties.mag,fillColor:"#"+n.colourAt(e.features[a].properties.mag),color:"#000",weight:1,opacity:1,fillOpacity:1})}}).bindPopup("Place: <b>"+e.features[a].properties.place+"</b></br>Magnitude : <b>"+e.features[a].properties.mag+"</b></br>Time : "+t(e.features[a].properties.time)+"</br>Depth : "+e.features[a].geometry.coordinates[2]+" km"),i.earthquakes.time[a]=e.features[a].properties.time,i.earthquakes.depth[a]=e.features[a].geometry.coordinates[2],i.earthquakes.depth[a]>i.values.maxdepth&&(i.values.maxdepth=i.earthquakes.depth[a]),i.earthquakes.depth[a]<i.values.mindepth&&(i.values.mindepth=i.earthquakes.depth[a]),o.timeLine.append(a>0?TweenLite.delayedCall(20*((e.features[a].properties.time-e.features[a-1].properties.time)/1e9),i.mapAdder,[a.toString()]):TweenLite.delayedCall(0,i.mapAdder,[a.toString()]));n.setNumberRange(i.values.mindepth,i.values.maxdepth),i.values.timediff=e.features[i.values.size-1].properties.time-e.features[0].properties.time,i.parameters.starttime=e.features[0].properties.time,$("#slider").slider({value:0,range:"min",min:0,max:i.values.timediff,slide:function(e,a){$("#date").html(t(i.parameters.starttime)),o.timeLine.pause(),o.timeLine.progress(a.value/i.values.timediff)
}}),$("#info").html("</br></br>total earthquakes : "+i.values.size+"</br>minimum depth : "+i.values.mindepth+" km</br>maximum depth : "+i.values.maxdepth+" km</br></br></br><div class='ui-body ui-body-a'><p><a href='http://github.com/gizmoabhinav/Seismic-Eruptions'>Link to the project</a></p></div>"),$("#startdate").html("Start date : "+t(i.parameters.startdate)),$("#enddate").html("End date : "+t(i.parameters.enddate)),$("#magcutoff").html("Cutoff magnitude : "+i.parameters.mag)},a()}};$("#index").on("pageshow",function(){$.mobile.loading("show"),i.leafletMap.invalidateSize(!0),i.parameters.defaultInit(),i.layers.baseLayer1.addTo(i.leafletMap),i.leafletMap.fitBounds([[50,40],[-20,-40]]),i.leafletMap.setMaxBounds([[-90,180],[90,-180]]),o.timeLine.timeScale(o.speed),o.timeLine.pause(),o.initController(),$.mobile.loading("hide"),setTimeout(function(){i.leafletMap.invalidateSize()},1),o.timeLine.resume()}),$("#play").click(function(){o.timeLine.resume()}),$("#pause").click(function(){o.timeLine.pause()}),$("#speedup").click(function(){o.speed*=1.5,o.timeLine.timeScale(o.speed)}),$("#speeddown").click(function(){o.speed>=.5&&(o.speed/=2,o.timeLine.timeScale(o.speed))}),$("#changeparams").click(function(){o.timeLine.pause()}),$("#editparamscancel").click(function(){o.timeLine.resume()}),$("#editparamsenter").click(function(){o.timeLine.pause()});for(var s=document.getElementById("date-1-y"),l=document.getElementById("date-2-y"),h=1960;2015!=h;){var c,d;c=document.createElement("option"),c.setAttribute("value",parseInt(h)-1900),c.innerHTML=h,s.appendChild(c),d=document.createElement("option"),d.setAttribute("value",parseInt(h)-1900),d.innerHTML=h,l.appendChild(d),h=parseInt(h)+1}$("#index").click(function(){$("#playcontrols").fadeIn(),$("#slider").fadeIn(),$("#date").fadeIn(),setTimeout(function(){$("#playcontrols").fadeOut()},5e3),setTimeout(function(){$("#slider").fadeOut(),$("#date").fadeOut()},12e3)}),$("#playback").hover(function(){$("#playcontrols").fadeIn(),$("#slider").fadeIn(),$("#date").fadeIn(),setTimeout(function(){$("#slider").fadeOut(),$("#date").fadeOut(),$("#playcontrols").fadeOut()},8e3)}),setTimeout(function(){$("#slider").fadeOut(),$("#date").fadeOut(),$("#playcontrols").fadeOut()},1e4);var u=!1;return $("#drawingTool").click(function(){if(!u){o.timeLine.pause(),$.mobile.loading("show"),$("#playback").fadeOut(),$("#crosssection").fadeIn();for(var e=0;e<i.values.size;e++)i.leafletMap.hasLayer(i.earthquakes.circles[e])||(i.earthquakes.circles[e].setStyle({fillOpacity:.5,fillColor:"#"+n.colourAt(i.earthquakes.depth[e])}),i.earthquakes.circles[e].addTo(i.leafletMap));$.mobile.loading("hide"),u=!0}}),$("#drawingToolDone").click(function(){u&&($.mobile.loading("show"),$("#playback").fadeIn(),$("#crosssection").fadeOut(),$.mobile.loading("hide"),u=!1,i.leafletMap.setZoom(2))}),$("#mapselector").change(function(){switch(i.leafletMap.hasLayer(i.layers.baseLayer1)&&i.leafletMap.removeLayer(i.layers.baseLayer1),i.leafletMap.hasLayer(i.layers.baseLayer2)&&i.leafletMap.removeLayer(i.layers.baseLayer2),i.leafletMap.hasLayer(i.layers.baseLayer3)&&i.leafletMap.removeLayer(i.layers.baseLayer3),$("#mapselector").val()){case"1":i.layers.baseLayer1.addTo(i.leafletMap),i.leafletMap.hasLayer(i.layers.baseLayer2)&&i.leafletMap.removeLayer(i.layers.baseLayer2),i.leafletMap.hasLayer(i.layers.baseLayer3)&&i.leafletMap.removeLayer(i.layers.baseLayer3);break;case"2":i.layers.baseLayer2.addTo(i.leafletMap),i.leafletMap.hasLayer(i.layers.baseLayer3)&&i.leafletMap.removeLayer(i.layers.baseLayer3),i.leafletMap.hasLayer(i.layers.baseLayer1)&&i.leafletMap.removeLayer(i.layers.baseLayer1);break;case"3":i.layers.baseLayer3.addTo(i.leafletMap),i.leafletMap.hasLayer(i.layers.baseLayer2)&&i.leafletMap.removeLayer(i.layers.baseLayer2),i.leafletMap.hasLayer(i.layers.baseLayer1)&&i.leafletMap.removeLayer(i.layers.baseLayer1)}}),$("#date-1-y").change(function(){loadCount(1)}),$("#date-1-m").change(function(){loadCount(1)}),$("#date-2-y").change(function(){loadCount(1)}),$("#date-2-m").change(function(){loadCount(1)}),i}();