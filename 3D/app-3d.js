!function(){"use strict";var t="undefined"==typeof window?global:window;if("function"!=typeof t.require){var e={},i={},s={},r={}.hasOwnProperty,o="components/",n=function(t,e){var i=0;e&&(0===e.indexOf(o)&&(i=o.length),e.indexOf("/",i)>0&&(e=e.substring(i,e.indexOf("/",i))));var r=s[t+"/index.js"]||s[e+"/deps/"+t+"/index.js"];return r?o+r.substring(0,r.length-".js".length):t},a=/^\.\.?(\/|$)/,l=function(t,e){for(var i,s=[],r=(a.test(e)?t+"/"+e:e).split("/"),o=0,n=r.length;n>o;o++)i=r[o],".."===i?s.pop():"."!==i&&""!==i&&s.push(i);return s.join("/")},c=function(t){return t.split("/").slice(0,-1).join("/")},m=function(e){return function(i){var s=l(c(e),i);return t.require(s,e)}},h=function(t,e){var s={id:t,exports:{}};return i[t]=s,e(s.exports,m(t),s),s.exports},d=function(t,s){var o=l(t,".");if(null==s&&(s="/"),o=n(t,s),r.call(i,o))return i[o].exports;if(r.call(e,o))return h(o,e[o]);var a=l(o,"./index");if(r.call(i,a))return i[a].exports;if(r.call(e,a))return h(a,e[a]);throw new Error('Cannot find module "'+t+'" from "'+s+'"')};d.alias=function(t,e){s[e]=t},d.register=d.define=function(t,i){if("object"==typeof t)for(var s in t)r.call(t,s)&&(e[s]=t[s]);else e[t]=i},d.list=function(){var t=[];for(var i in e)r.call(e,i)&&t.push(i);return t},d.brunch=!0,d._cache=i,t.require=d}}(),require.define({"3D/main":function(t,e,i){var s,r,o,n;n=e("3D/scene"),o=e("3D/plot"),s=e("common/data-loader"),r=function(){function t(){this.util=e("common/util"),this.limits=e("3D/map-limits")}return t.prototype.start=function(){return $.mobile.loading("show"),this.scene=new n,this.scene.initialize(),$.mobile.loading("hide"),this.scene.animateScene(),this.plot=new o,this.plot.setup(this.scene),this.plot.loadquakes()},t.prototype.miniMap=function(){var t,e,i,r,o,n;return r=new Rainbow,o=document.createElement("script"),e=L.map("map"),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:6}).addTo(e),i=function(t,e){return L.circleMarker(e,{radius:3,fillColor:"#"+r.colourAt(t.properties.mag),color:"#000",weight:1,opacity:1,fillOpacity:1})},t=new s,n="http://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&orderby=time-asc&starttime="+this.util.getURLParameter("startdate")+"T00:00:00&endtime="+this.util.getURLParameter("enddate")+"T23:59:59&minmagnitude="+this.util.getURLParameter("mag")+"&minlatitude="+Math.min(this.limits.latlng.y1,this.limits.latlng.y2,this.limits.latlng.y3,this.limits.latlng.y4)+"&maxlatitude="+Math.max(this.limits.latlng.y1,this.limits.latlng.y2,this.limits.latlng.y3,this.limits.latlng.y4)+"&minlongitude="+Math.min(this.limits.latlng.x1,this.limits.latlng.x2,this.limits.latlng.x3,this.limits.latlng.x4)+"&maxlongitude="+Math.max(this.limits.latlng.x1,this.limits.latlng.x2,this.limits.latlng.x3,this.limits.latlng.x4),t.load(n).then(function(t){return function(s){var r,o,n,a,l;for(l=s.features.length,a=s.features,o=0,n=a.length;n>o;o++)r=a[o],L.geoJson(r,{pointToLayer:i}).bindPopup("Place: <b>"+r.properties.place+"</b></br>Magnitude : <b>"+r.properties.mag+"</b></br>Time : "+t.util.timeConverter(r.properties.time)+"</br>Depth : "+r.geometry.coordinates[2]+" km").addTo(e);return L.polygon([[parseFloat(t.limits.latlng.y1),parseFloat(t.limits.latlng.x1)],[parseFloat(t.limits.latlng.y2),parseFloat(t.limits.latlng.x2)],[parseFloat(t.limits.latlng.y3),parseFloat(t.limits.latlng.x3)],[parseFloat(t.limits.latlng.y4),parseFloat(t.limits.latlng.x4)]]).addTo(e),e.fitBounds([[parseFloat(t.limits.latlng.y1),parseFloat(t.limits.latlng.x1)],[parseFloat(t.limits.latlng.y2),parseFloat(t.limits.latlng.x2)],[parseFloat(t.limits.latlng.y3),parseFloat(t.limits.latlng.x3)],[parseFloat(t.limits.latlng.y4),parseFloat(t.limits.latlng.x4)]]),e.setZoom(e.getZoom()-1)}}(this))},t}(),i.exports=r}}),require.define({"3D/map-limits":function(t,e,i){var s;s=function(){function t(){this.util=e("common/util"),this.latlng={x1:this.util.getURLParameter("x1"),x2:this.util.getURLParameter("x2"),x3:this.util.getURLParameter("x3"),x4:this.util.getURLParameter("x4"),y1:this.util.getURLParameter("y1"),y2:this.util.getURLParameter("y2"),y3:this.util.getURLParameter("y3"),y4:this.util.getURLParameter("y4")},this.coords={x1:this.util.convertCoordinatesx(this.latlng.x1),y1:this.util.convertCoordinatesy(this.latlng.y1),x2:this.util.convertCoordinatesx(this.latlng.x2),y2:this.util.convertCoordinatesy(this.latlng.y2),x3:this.util.convertCoordinatesx(this.latlng.x3),y3:this.util.convertCoordinatesy(this.latlng.y3),x4:this.util.convertCoordinatesx(this.latlng.x4),y4:this.util.convertCoordinatesy(this.latlng.y4)},this.coords.minx=Math.min(this.coords.x1,this.coords.x2,this.coords.x3,this.coords.x4),this.coords.miny=Math.min(this.coords.y1,this.coords.y2,this.coords.y3,this.coords.y4),this.coords.maxx=Math.max(this.coords.x1,this.coords.x2,this.coords.x3,this.coords.x4),this.coords.maxy=Math.max(this.coords.y1,this.coords.y2,this.coords.y3,this.coords.y4),3-Math.ceil(this.coords.maxx-this.coords.minx)>=0&&3-Math.ceil(this.coords.maxy-this.coords.miny)>=0?(this.coords.leftTileLimit=Math.floor(this.coords.minx-(3-Math.ceil(this.coords.maxx-this.coords.minx))),this.coords.topTileLimit=Math.floor(this.coords.miny-(3-Math.ceil(this.coords.maxy-this.coords.miny)))):(this.coords.leftTileLimit=Math.floor(this.coords.minx),this.coords.topTileLimit=Math.floor(this.coords.miny)),this.coords.midx=(this.coords.maxx+this.coords.minx)/2,this.coords.midy=(this.coords.maxy+this.coords.miny)/2}return t}(),i.exports=new s}}),require.define({"3D/plot":function(t,e,i){var s,r;s=e("common/data-loader"),r=function(){function t(){}return t.prototype.setup=function(t){var i,s,r,o;return this.scene=t,this.util=e("common/util"),this.limits=e("3D/map-limits"),this.rainbow=new Rainbow,this.rainbow.setSpectrum("#A52A2A","#FF0000","#800080","#FF00FF","#2f9898","#266fc1","#0000ff","#00FFFF","#50f950","#FFFF00"),this.rainbow.setNumberRange(0,700),this.sphereParent=new THREE.Object3D,this.mag=this.util.getURLParameter("mag"),this.startdate=this.util.getURLParameter("startdate")||"2009/1/1",this.enddate=this.util.getURLParameter("enddate"),"undefined"==typeof enddate||null===enddate?(o=new Date,r=o.getFullYear(),s=o.getMonth()+1,i=o.getDate(),this.enddate=r+"/"+s+"/"+i):void 0},t.prototype.loadquakes=function(){var t,e;return this.count=0,this.maxdepth=0,this.mindepth=999,this.maxmag=0,this.minmag=999,t=new s,e="http://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&orderby=time-asc&minmagnitude="+this.mag+"&starttime="+this.startdate+"%2000:00:00&endtime="+this.enddate+"%2023:59:59&minlatitude="+Math.min(this.limits.latlng.y1,this.limits.latlng.y2,this.limits.latlng.y3,this.limits.latlng.y4)+"&maxlatitude="+Math.max(this.limits.latlng.y1,this.limits.latlng.y2,this.limits.latlng.y3,this.limits.latlng.y4)+"&minlongitude="+Math.min(this.limits.latlng.x1,this.limits.latlng.x2,this.limits.latlng.x3,this.limits.latlng.x4)+"&maxlongitude="+Math.max(this.limits.latlng.x1,this.limits.latlng.x2,this.limits.latlng.x3,this.limits.latlng.x4),t.load(e).then(function(t){return function(e){var i,s,r,o,n,a,l,c,m,h,d,u,p,g,f,y,x,E;if(h=e.features.length,0===h)return void alert("No earthquakes inside the cross section in given time range");for(m=e.features,r=0,o=m.length;o>r;r++)s=m[r],t._rect(t.util.convertCoordinatesx(s.geometry.coordinates[0]),t.util.convertCoordinatesy(s.geometry.coordinates[1]))&&(t.count++,t._processFeature(s));return $("#info").html("</br></br>total earthquakes : "+h+"</br>minimum depth : "+t.mindepth+" km</br>maximum depth : "+t.maxdepth+" km</br></br></br><div class='ui-body ui-body-a'><p><a href='http://github.com/gizmoabhinav/Seismic-Eruptions'>Link to the project</a></p></div>"),$("#startdate").html("Start date : "+t.util.timeConverter(t.startdate)),$("#enddate").html("End date : "+t.util.timeConverter(t.enddate)),$("#magcutoff").html("Cutoff magnitude : "+t.minmag),t.sphereParent.position.set(0,0,0),t.scene.scene.add(t.sphereParent),d=new THREE.Vector3(t.limits.coords.x1-t.limits.coords.leftTileLimit-2,-t.limits.coords.y1+t.limits.coords.topTileLimit+2,1),u=new THREE.Vector3(t.limits.coords.x2-t.limits.coords.leftTileLimit-2,-t.limits.coords.y2+t.limits.coords.topTileLimit+2,1),p=new THREE.Vector3(t.limits.coords.x3-t.limits.coords.leftTileLimit-2,-t.limits.coords.y3+t.limits.coords.topTileLimit+2,1),g=new THREE.Vector3(t.limits.coords.x4-t.limits.coords.leftTileLimit-2,-t.limits.coords.y4+t.limits.coords.topTileLimit+2,1),f=new THREE.Vector3(t.limits.coords.x1-t.limits.coords.leftTileLimit-2,-t.limits.coords.y1+t.limits.coords.topTileLimit+2,1-t.maxdepth/1e3),y=new THREE.Vector3(t.limits.coords.x2-t.limits.coords.leftTileLimit-2,-t.limits.coords.y2+t.limits.coords.topTileLimit+2,1-t.maxdepth/1e3),x=new THREE.Vector3(t.limits.coords.x3-t.limits.coords.leftTileLimit-2,-t.limits.coords.y3+t.limits.coords.topTileLimit+2,1-t.maxdepth/1e3),E=new THREE.Vector3(t.limits.coords.x4-t.limits.coords.leftTileLimit-2,-t.limits.coords.y4+t.limits.coords.topTileLimit+2,1-t.maxdepth/1e3),i=new THREE.Geometry,i.vertices.push(d),i.vertices.push(u),i.vertices.push(p),i.vertices.push(g),i.vertices.push(f),i.vertices.push(y),i.vertices.push(x),i.vertices.push(E),i.faces.push(new THREE.Face3(6,5,4)),i.faces.push(new THREE.Face3(4,7,6)),i.faces.push(new THREE.Face3(4,5,6)),i.faces.push(new THREE.Face3(6,7,4)),i.faces.push(new THREE.Face3(4,1,0)),i.faces.push(new THREE.Face3(5,1,4)),i.faces.push(new THREE.Face3(0,1,4)),i.faces.push(new THREE.Face3(4,1,5)),i.faces.push(new THREE.Face3(1,2,5)),i.faces.push(new THREE.Face3(5,2,6)),i.faces.push(new THREE.Face3(5,2,1)),i.faces.push(new THREE.Face3(6,2,5)),i.faces.push(new THREE.Face3(2,3,6)),i.faces.push(new THREE.Face3(6,3,7)),i.faces.push(new THREE.Face3(6,3,2)),i.faces.push(new THREE.Face3(7,3,6)),i.faces.push(new THREE.Face3(3,0,7)),i.faces.push(new THREE.Face3(7,0,3)),i.faces.push(new THREE.Face3(7,0,4)),i.faces.push(new THREE.Face3(4,0,7)),c=new THREE.MeshBasicMaterial({color:7798784,transparency:!0,opacity:.05,wireframe:!1}),l=new THREE.Mesh(i,c),a=new THREE.Geometry,a.vertices.push(d),a.vertices.push(u),a.vertices.push(p),a.vertices.push(g),a.vertices.push(d),a.vertices.push(f),a.vertices.push(y),a.vertices.push(x),a.vertices.push(E),a.vertices.push(f),a.vertices.push(y),a.vertices.push(u),a.vertices.push(p),a.vertices.push(x),a.vertices.push(E),a.vertices.push(g),n=new THREE.Line(a,new THREE.LineBasicMaterial({color:16777215,opacity:1})),t.scene.scene.add(n),t.scene.controls.target.z=1-t.maxdepth/2e3}}(this)),document.getElementById("frame").src="frame.html?x1="+this.limits.latlng.x1+"&x2="+this.limits.latlng.x2+"&x3="+this.limits.latlng.x3+"&x4="+this.limits.latlng.x4+"&y1="+this.limits.latlng.y1+"&y2="+this.limits.latlng.y2+"&y3="+this.limits.latlng.y3+"&y4="+this.limits.latlng.y4+"&startdate="+this.startdate+"&enddate="+this.enddate+"&mag="+this.mag},t.prototype._processFeature=function(t){return this._checkMinMax(t),this._createSphere(t)},t.prototype._checkMinMax=function(t){return t.geometry.coordinates[2]>this.maxdepth&&(this.maxdepth=t.geometry.coordinates[2]),t.geometry.coordinates[2]<this.mindepth&&(this.mindepth=t.geometry.coordinates[2]),t.properties.mag<this.minmag&&(this.minmag=t.properties.mag),t.properties.mag>this.maxmag?this.maxmag=t.properties.mag:void 0},t.prototype._createSphere=function(t){var e,i,s,r,o,n,a;return r=.0025*Math.pow(2,4*t.properties.mag/10),i=t.geometry.coordinates[0],s=t.geometry.coordinates[1],e=t.geometry.coordinates[2],n=new THREE.SphereGeometry(r,8,8),a=new THREE.MeshPhongMaterial({color:parseInt("0x"+this.rainbow.colourAt(t.geometry.coordinates[2])),overdraw:!1}),o=new THREE.Mesh(n,a),o.position.set(this.util.convertCoordinatesx(i)-this.limits.coords.leftTileLimit-2,-this.util.convertCoordinatesy(s)+this.limits.coords.topTileLimit+2,1-e/1e3),this.sphereParent.add(o)},t.prototype._rect=function(t,e){var i,s,r,o;return i=this.limits.coords.x2-this.limits.coords.x1,s=this.limits.coords.y2-this.limits.coords.y1,r=this.limits.coords.x4-this.limits.coords.x1,o=this.limits.coords.y4-this.limits.coords.y1,(t-this.limits.coords.x1)*i+(e-this.limits.coords.y1)*s<0?!1:(t-this.limits.coords.x2)*i+(e-this.limits.coords.y2)*s>0?!1:(t-this.limits.coords.x1)*r+(e-this.limits.coords.y1)*o<0?!1:(t-this.limits.coords.x4)*r+(e-this.limits.coords.y4)*o>0?!1:!0},t}(),i.exports=r}}),require.define({"3D/scene":function(t,e,i){var s;s=function(){function t(){}return t.prototype.initialize=function(){var t,i,s,r,o,n,a,l,c,m,h,d,u,p,g,f;for(this.limits=e("3D/map-limits"),Detector.webgl?(this.renderer=new THREE.WebGLRenderer({antialias:!0}),$("#rendererInfo").html("<font color='white'>WebGL Renderer</font>")):(this.renderer=new THREE.CanvasRenderer,$("#rendererInfo").html("<font color='white'>Canvas Renderer</font>")),this.renderer.setClearColor(7829367,1),s=window.innerWidth,i=window.innerHeight,this.renderer.setSize(s,i),document.getElementById("WebGLCanvas").appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(25,s/i,1,100),this.camera.lookAt(new THREE.Vector3(this.limits.coords.midx-this.limits.coords.leftTileLimit-2,-this.limits.coords.midy+this.limits.coords.topTileLimit+2,1)),this.camera.position.set(.1953529215215685,-5.647229198648456,1.4347925563786978),this.camera.rotation.set(1.439025394333189,.03591325303244356,.004758846432708524),this.camera.up.set(0,0,1),this.scene.add(this.camera),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",document.getElementById("WebGLCanvas").appendChild(this.stats.domElement),this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.x=this.limits.coords.midx-this.limits.coords.leftTileLimit-2,this.controls.target.y=-this.limits.coords.midy+this.limits.coords.topTileLimit+2,this.controls.target.z=1,this.controls.maxDistance=8,u=new THREE.SphereGeometry(90,32,32),p=new THREE.MeshBasicMaterial({color:10066329}),p.side=THREE.BackSide,g=new THREE.Mesh(u,p),this.scene.add(g),this.group=new THREE.Object3D,h=Detector.webgl?new THREE.PlaneGeometry(1,1,1):new THREE.PlaneGeometry(1,1,1,2,0,2),f=Detector.webgl?"../images/tiles/6/":"http://otile1.mqcdn.com/tiles/1.0.0/sat/6/",l=c=0;4>c;l=++c)for(a=m=0;4>m;a=++m)n=new THREE.ImageUtils.loadTexture(f+(this.limits.coords.leftTileLimit+a)+"/"+(this.limits.coords.topTileLimit+l)+".png"),n.wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(1,1),d=new THREE.MeshBasicMaterial({map:n,depthWrite:!1,depthTest:!1,transparent:!0,opacity:.5,side:THREE.DoubleSide,combine:THREE.MixOperation}),r=new THREE.Mesh(h,d),r.position.set(a+.5-2,-l-.5+2,1),this.group.add(r);return this.scene.add(this.group),t=new THREE.AmbientLight(1052688,10),this.scene.add(t),o=new THREE.DirectionalLight(16777215,1),o.position=this.camera.position,this.scene.add(o)},t.prototype.animateScene=function(){return requestAnimationFrame(this.animateScene.bind(this)),this.renderScene(),this.stats.update()},t.prototype.renderScene=function(){return this.renderer.render(this.scene,this.camera)},t.prototype.mapToggle=function(){return $("#maptoggle").is(":checked")?(group.traverse(function(t){return t.visible=!0}),group.visible=!0):(group.traverse(function(t){return t.visible=!1}),group.visible=!1)},t.prototype.thumbnailToggle=function(){return $("#thumbnail").is(":checked")?$("#iframe2d").fadeIn():$("#iframe2d").fadeOut()},t}(),i.exports=s}}),require.define({"common/data-loader":function(t,e,i){var s;s=function(){function t(){}return t.prototype.load=function(t,e){var i,s,r;return r=null!=e?e:{},i=r.ajax,s=r.callback,new Promise(function(e){return function(r,o){var n,a;return i?$.ajax({url:t,dataType:"json",success:function(t){return r(t)},error:function(t){return o(t)}}):(n=null!=s?s:"request_"+Math.random().toString(36).substr(2,8),a=e.injectScript(n,t,null==s),e.createListener(n,a,r,o),document.body.appendChild(a))}}(this))},t.prototype.createListener=function(t,e,i,s){return window[t]=function(s){return document.body.removeChild(e),delete window[t],i(s)}},t.prototype.injectScript=function(t,e,i){var s;return null==i&&(i=!0),s=document.createElement("script"),s.src=e+(i?"&callback="+t:""),s.id=t,s},t}(),i.exports=s}}),require.define({"common/util":function(t,e,i){var s,r={}.hasOwnProperty;s=function(){function t(){}return t.prototype.getURLParameter=function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null},t.prototype.convertCoordinatesx=function(t){return t=parseFloat(t),t=64*(t+180)/360},t.prototype.convertCoordinatesy=function(t){return t=parseFloat(t),t*=Math.PI/180,t=32*(1-Math.log(Math.tan(t)+1/Math.cos(t))/Math.PI)},t.prototype.toLon=function(t){return t=parseFloat(t),t=360*t/64-180},t.prototype.toLat=function(t){return t=parseFloat(t),t=2*(Math.atan(Math.pow(Math.E,(1-t/32)*Math.PI))-Math.PI/4),t=180*t/Math.PI},t.prototype._months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t.prototype.timeConverter=function(t){var e,i,s,r,o;return e=new Date(t),o=e.getFullYear(),s=this._months[e.getMonth()],i=e.getDate(),r=o+" "+s+" "+i},t.prototype.usgsDate=function(t){return t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()},t.prototype.queryString=function(t,e){var i,s,o,n;null==e&&(e={}),i=t.leafletMap.getCenter(),o={zoom:t.leafletMap.getZoom(),center:i.lat+","+i.lng,mag:t.parameters.desiredMag,startdate:t.parameters.startdate,enddate:t.parameters.enddate},t.parameters.timeline&&(o.timeline=!0);for(s in e)r.call(e,s)&&(n=e[s],o[s]=n);return"?"+$.param(o)},t}(),i.exports=new s}});